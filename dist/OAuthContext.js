"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("@babel/polyfill");var _queryString=_interopRequireDefault(require("query-string")),_VerifyError=_interopRequireDefault(require("./errors/VerifyError")),_StorageHandler=_interopRequireDefault(require("./helpers/StorageHandler")),_config=require("./config"),_apiRequest=_interopRequireDefault(require("./helpers/apiRequest")),_utils=_interopRequireDefault(require("./helpers/utils"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}var OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR=_config.AppConfig.OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,OAUTH_CONTEXT_API_ERROR=_config.AppConfig.OAUTH_CONTEXT_API_ERROR,TOKEN_ERROR=_config.AppConfig.TOKEN_ERROR;/**
 *
 * @param {object} config users configuration settings to kick off
 * OAuth implicit flow
 */function OAuthContext(a){if(!a)throw new _VerifyError.default(OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,"Config parameter is required");//Verify config settings
if(!a.clientId)throw new _VerifyError.default(OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,"clientId property is required");if(!a.tenantUrl)throw new _VerifyError.default(OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,"Tenant URL is required");if(!a.redirectUri&&"client_credentials"!==a.flowType)throw new _VerifyError.default(OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,"A redirect URL is required");if(!a.responseType&&"client_credentials"!==a.flowType)throw new _VerifyError.default(OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,"Response Type required");if(!a.scope)throw new _VerifyError.default(OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,"scope Property not set in Config settings");if("AZN"===a.flowType&&!a.clientSecret)throw new _VerifyError.default(OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,"Client Secret is required for the AZN code flow");if("Implicit"!==a.flowType&&"AZN"!==a.flowType&&"client_credentials"!==a.flowType)throw new _VerifyError.default(OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,"Check the flowType property in your configuration object is correct. Supported Values: \"Implicit\", \"AZN\", \"client_credentials\"");if("Implicit"===a.flowType){if(_utils.default.isNode())throw new _VerifyError.default(OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,"Implicit flow not supported in Node");if(!a.storageType)throw new _VerifyError.default(OAUTH_CONTEXT_CONFIG_SETTINGS_ERROR,"storageType property not set.");this.storageHandler=new _StorageHandler.default(a.storageType)}this.config=a}/**
 * @function isAuthenticated to check current users access_token or refresh_token to
 * determine if they are still valid.
 * @param {object} token the token object with access_token, refreshToken etc.
 */OAuthContext.prototype.isAuthenticated=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.introspectToken(b);case 3:return c=a.sent,a.abrupt("return",!0===c.response.active);case 7:return a.prev=7,a.t0=a["catch"](0),a.abrupt("return",Promise.reject(a.t0));case 10:case"end":return a.stop();}},a,this,[[0,7]])}));return function(){return a.apply(this,arguments)}}(),OAuthContext.prototype.introspectToken=function(a){var b=a||this.token;if(!_utils.default.isToken(a))return Promise.reject(new _VerifyError.default(TOKEN_ERROR,"Token parameter is not a valid token"));var c="".concat(this.config.tenantUrl,"/v1.0/endpoint/default/introspect"),d={client_id:this.config.clientId,client_secret:this.config.clientSecret,token:b.access_token},e=_queryString.default.stringify(d);return this.handleResponse({method:"POST",url:c,contentType:"application/x-www-form-urlencoded",data:e},b)},OAuthContext.prototype.userinfo=function(a){var b=a||this.token;if(!_utils.default.isToken(b))return Promise.reject(new _VerifyError.default(TOKEN_ERROR,"Token parameter is not a valid token"));var c="".concat(this.config.tenantUrl,"/v1.0/endpoint/default/userinfo"),d={method:"POST",url:c,contentType:"application/x-www-form-urlencoded",data:_queryString.default.stringify(b.access_token)};return this.handleResponse(d,b)},OAuthContext.prototype.fetchToken=function(){if("Implicit"===this.config.flowType)try{var a=JSON.parse(this.storageHandler.getStorage("token"));return a}catch(a){return null}else throw new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"fetchToken() can only be used with Implicit flow")},OAuthContext.prototype.getConfig=function(){return this.config},OAuthContext.prototype.logout=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b,c){var d,e=arguments;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("Implicit"!==this.config.flowType){a.next=10;break}return d=this.fetchToken(),a.next=4,this.revokeToken(d,"access_token");case 4:return a.next=6,this.storageHandler.clearStorage();case 6:return a.next=8,window.location.replace(b||"/");case 8:a.next=13;break;case 10:2!==e.length||_utils.default.isToken(c)||Promise.reject(new _VerifyError.default(TOKEN_ERROR,"not a valid token.")),1!==e.length||_utils.default.isToken(b)||Promise.reject(new _VerifyError.default(TOKEN_ERROR,"not a valid token.")),2===e.length?this.revokeToken(c,"access_token"):this.revokeToken(b,"access_token");case 13:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),OAuthContext.prototype.revokeToken=function(a,b){var c,d,e,f="".concat(this.config.tenantUrl,"/v1.0/endpoint/default/revoke");if(2>arguments.length)throw new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"revokeToken(token, tokenType), 2 parameters are required "+arguments.length+" were given");if(!a)throw new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"token cannot be null");if("access_token"!==b&&"refresh_token"!==b)throw new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"Parameter: ".concat(b," is invalid.\n Supported values are \"access_token\" or \"refresh_token"));c="access_token"===b?a.access_token:a.refresh_token;var g={client_id:this.config.clientId,client_secret:this.config.clientSecret,token:c};// token is not required, but handleResponse will throw error without it
return d=_queryString.default.stringify(g),e={method:"POST",contentType:"application/x-www-form-urlencoded",url:f,data:d},this.handleResponse(e,a)},OAuthContext.prototype._parseUrlHash=function(a){var b=_queryString.default.parse(a);return b},OAuthContext.prototype._setSession=function(){var a=this;if(_utils.default.isNode())throw new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"_setSession() is not supported in Node");var b=JSON.parse(this.storageHandler.getStorage("token")).expires_in,c=_config.AppConfig.DEFAULT_CLOCK_SKEW,d=b-(Date.now()-c);0<d&&setTimeout(function(){a.session=!1,a.storageHandler.clearStorage()},d)},OAuthContext.prototype.getToken=function(a){if("Implicit"===this.config.flowType)throw new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"getToken() cannot be used with Implicit flow");if(!a)// change message
throw new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"getToken(params), Params are required");var b="client_credentials"===this.config.flowType?a:a.substring(a.indexOf("?"));var c="object"===_typeof(b)?b:_queryString.default.parse(b),d="".concat(this.config.tenantUrl,"/v1.0/endpoint/default/token");"client_credentials"===this.config.flowType?c.grant_type=this.config.flowType:(c.redirect_uri=this.config.redirectUri,c.grant_type="authorization_code"),c.client_id=this.config.clientId,c.client_secret=this.config.clientSecret,c.scope=this.config.scope;var e=_queryString.default.stringify(c);return(0,_apiRequest.default)({method:"POST",url:d,contentType:"application/x-www-form-urlencoded",data:e})},OAuthContext.prototype.refreshToken=function(a){if("Implicit"===this.config.flowType)return Promise.reject(new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"Implicit flow does not support refresh token"));if(!a.hasOwnProperty("refresh_token"))return Promise.reject(new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"refresh_token is a required parameter"));var b="".concat(this.config.tenantUrl,"/v1.0/endpoint/default/token"),c={refresh_token:a.refresh_token,client_id:this.config.clientId,client_secret:this.config.clientSecret,grant_type:"refresh_token",scope:this.config.scope},d=_queryString.default.stringify(c);return(0,_apiRequest.default)({method:"POST",url:b,contentType:"application/x-www-form-urlencoded",data:d})},OAuthContext.prototype._authorize=function(a){return this._buildUrl(a)},OAuthContext.prototype.login=function(){var a=this._authorize(this.config);return a},OAuthContext.prototype._buildUrl=function(a){return a.tenantUrl+"/oidc/endpoint/default/authorize?"+_queryString.default.stringify({client_id:a.clientId,redirect_uri:a.redirectUri,scope:a.scope,response_type:a.responseType,state:_utils.default.randomString(16),nonce:_utils.default.randomString(16)})},OAuthContext.prototype.authenticate=function(){return new Promise(function(a){a(this._authorize(this.config))}.bind(this))},OAuthContext.prototype._parseHash=function(a){var b=_queryString.default.parse(a);return b},OAuthContext.prototype.handleResponse=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b,c){var d,e,f,g,h,i=arguments;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!(2>i.length)){a.next=2;break}throw new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"handleResponse(options, token), 2 parameters are required "+i.length+" were given");case 2:if(_utils.default.isToken(c)){a.next=4;break}return a.abrupt("return",Promise.reject(new _VerifyError.default(TOKEN_ERROR,"not a valid token")));case 4:return d=c,e={response:null,token:null},a.prev=6,a.next=9,(0,_apiRequest.default)(b,d.access_token);case 9:if(f=a.sent,e.response=f,"Implicit"!==this.config.flowType){a.next=13;break}return a.abrupt("return",Promise.resolve(f));case 13:return a.abrupt("return",Promise.resolve(e));case 16:if(a.prev=16,a.t0=a["catch"](6),!(401===a.t0.status&&_utils.default.isNode())){a.next=29;break}if(d.refresh_token){a.next=21;break}return a.abrupt("return",Promise.reject(new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"access_token expired and refresh_token not found")));case 21:return a.next=23,this.refreshToken(d);case 23:return g=a.sent,a.next=26,(0,_apiRequest.default)(b,g.access_token);case 26:return h=a.sent,e={response:h,token:g},a.abrupt("return",Promise.resolve(e));case 29:return a.abrupt("return",Promise.reject(a.t0));case 30:case"end":return a.stop();}},a,this,[[6,16]])}));return function(){return a.apply(this,arguments)}}(),OAuthContext.prototype.handleCallback=function(){if(_utils.default.isNode())throw new _VerifyError.default(OAUTH_CONTEXT_API_ERROR,"handleCallback() is only for Implicit flow");var a,b=/#error/,c=window.location.hash;return a="object"===_typeof(c)?c:this._parseUrlHash(c),new Promise(function(d){b.test(c)?d(a):(this.storageHandler.setStorage(a),this._setSession(),window.location.hash="")}.bind(this))};var _default=OAuthContext;exports.default=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9PQXV0aENvbnRleHQuanMiXSwibmFtZXMiOlsiT0FVVEhfQ09OVEVYVF9DT05GSUdfU0VUVElOR1NfRVJST1IiLCJBcHBDb25maWciLCJPQVVUSF9DT05URVhUX0FQSV9FUlJPUiIsIlRPS0VOX0VSUk9SIiwiT0F1dGhDb250ZXh0IiwiY29uZmlnIiwiVmVyaWZ5RXJyb3IiLCJjbGllbnRJZCIsInRlbmFudFVybCIsInJlZGlyZWN0VXJpIiwiZmxvd1R5cGUiLCJyZXNwb25zZVR5cGUiLCJzY29wZSIsImNsaWVudFNlY3JldCIsInV0aWxzIiwiaXNOb2RlIiwic3RvcmFnZVR5cGUiLCJzdG9yYWdlSGFuZGxlciIsIlN0b3JhZ2VIYW5kbGVyIiwicHJvdG90eXBlIiwiaXNBdXRoZW50aWNhdGVkIiwidG9rZW4iLCJpbnRyb3NwZWN0VG9rZW4iLCJwYXlsb2FkIiwicmVzcG9uc2UiLCJhY3RpdmUiLCJQcm9taXNlIiwicmVqZWN0IiwidG9rZW5PYmoiLCJpc1Rva2VuIiwicGF0aCIsImRhdGEiLCJjbGllbnRfaWQiLCJjbGllbnRfc2VjcmV0IiwiYWNjZXNzX3Rva2VuIiwiZW5jb2RlZERhdGEiLCJxcyIsInN0cmluZ2lmeSIsImhhbmRsZVJlc3BvbnNlIiwibWV0aG9kIiwidXJsIiwiY29udGVudFR5cGUiLCJ1c2VyaW5mbyIsIm9wdGlvbnMiLCJmZXRjaFRva2VuIiwiYWNjZXNzVG9rZW4iLCJKU09OIiwicGFyc2UiLCJnZXRTdG9yYWdlIiwiZXJyb3IiLCJnZXRDb25maWciLCJsb2dvdXQiLCJyZXZva2VUb2tlbiIsImNsZWFyU3RvcmFnZSIsIndpbmRvdyIsImxvY2F0aW9uIiwicmVwbGFjZSIsImxlbmd0aCIsInRva2VuVHlwZSIsImV4cGlyZVRva2VuIiwiYXJndW1lbnRzIiwicmVmcmVzaF90b2tlbiIsIl9wYXJzZVVybEhhc2giLCJoYXNoU3RyaW5nIiwicGFyc2VkSGFzaCIsIl9zZXRTZXNzaW9uIiwiZXhwaXJlc0F0IiwiZXhwaXJlc19pbiIsImNsb2NrU2tldyIsIkRFRkFVTFRfQ0xPQ0tfU0tFVyIsImRlbGF5IiwiRGF0ZSIsIm5vdyIsInNldFRpbWVvdXQiLCJzZXNzaW9uIiwiZ2V0VG9rZW4iLCJwYXJhbXMiLCJxdWVyeSIsInN1YnN0cmluZyIsImluZGV4T2YiLCJncmFudF90eXBlIiwicmVkaXJlY3RfdXJpIiwicmVmcmVzaFRva2VuIiwiaGFzT3duUHJvcGVydHkiLCJfYXV0aG9yaXplIiwiX2J1aWxkVXJsIiwibG9naW4iLCJvcHRzIiwicmVzcG9uc2VfdHlwZSIsInN0YXRlIiwicmFuZG9tU3RyaW5nIiwibm9uY2UiLCJhdXRoZW50aWNhdGUiLCJyZXNvbHZlIiwiYmluZCIsIl9wYXJzZUhhc2giLCJzdGF0dXMiLCJuZXdUb2tlbiIsIm9yaWdpbmFsUmVxdWVzdCIsImhhbmRsZUNhbGxiYWNrIiwidXJsT2JqIiwiZXJyb3JDaGVjayIsImhhc2giLCJ0ZXN0Iiwic2V0U3RvcmFnZSJdLCJtYXBwaW5ncyI6ImtxQ0FTQ0EsQ0FBQUEsbUMsQ0FHR0MsaUIsQ0FISEQsbUMsQ0FDQUUsdUIsQ0FFR0QsaUIsQ0FGSEMsdUIsQ0FDQUMsVyxDQUNHRixpQixDQURIRSxXLENBRUQ7Ozs7R0FLQSxRQUFTQyxDQUFBQSxZQUFULENBQXNCQyxDQUF0QixDQUE4QixDQUM3QixHQUFJLENBQUNBLENBQUwsQ0FDQyxLQUFNLElBQUlDLHFCQUFKLENBQWdCTixtQ0FBaEIsQ0FBcUQsOEJBQXJELENBQU4sQ0FFRDtBQUNBLEdBQUksQ0FBQ0ssQ0FBTSxDQUFDRSxRQUFaLENBQ0MsS0FBTSxJQUFJRCxxQkFBSixDQUFnQk4sbUNBQWhCLENBQXFELCtCQUFyRCxDQUFOLENBRUQsR0FBSSxDQUFDSyxDQUFNLENBQUNHLFNBQVosQ0FDQyxLQUFNLElBQUlGLHFCQUFKLENBQWdCTixtQ0FBaEIsQ0FBcUQsd0JBQXJELENBQU4sQ0FFRCxHQUFJLENBQUNLLENBQU0sQ0FBQ0ksV0FBUixFQUEyQyxvQkFBcEIsR0FBQUosQ0FBTSxDQUFDSyxRQUFsQyxDQUNDLEtBQU0sSUFBSUoscUJBQUosQ0FBZ0JOLG1DQUFoQixDQUFxRCw0QkFBckQsQ0FBTixDQUVELEdBQUksQ0FBQ0ssQ0FBTSxDQUFDTSxZQUFSLEVBQTRDLG9CQUFwQixHQUFBTixDQUFNLENBQUNLLFFBQW5DLENBQ0MsS0FBTSxJQUFJSixxQkFBSixDQUFnQk4sbUNBQWhCLENBQXFELHdCQUFyRCxDQUFOLENBRUQsR0FBSSxDQUFDSyxDQUFNLENBQUNPLEtBQVosQ0FDQyxLQUFNLElBQUlOLHFCQUFKLENBQWdCTixtQ0FBaEIsQ0FBcUQsMkNBQXJELENBQU4sQ0FFRCxHQUF3QixLQUFwQixHQUFBSyxDQUFNLENBQUNLLFFBQVAsRUFBNkIsQ0FBQ0wsQ0FBTSxDQUFDUSxZQUF6QyxDQUNDLEtBQU0sSUFBSVAscUJBQUosQ0FBZ0JOLG1DQUFoQixDQUFxRCxpREFBckQsQ0FBTixDQUdELEdBQTBCLFVBQXBCLEdBQUFLLENBQU0sQ0FBQ0ssUUFBUCxFQUFzRCxLQUFwQixHQUFBTCxDQUFNLENBQUNLLFFBQXpDLEVBQW1GLG9CQUFwQixHQUFBTCxDQUFNLENBQUNLLFFBQTVFLENBQ0MsS0FBTSxJQUFJSixxQkFBSixDQUFnQk4sbUNBQWhCLENBQXFELHNJQUFyRCxDQUFOLENBR0QsR0FBd0IsVUFBcEIsR0FBQUssQ0FBTSxDQUFDSyxRQUFYLENBQW9DLENBQ25DLEdBQUlJLGVBQU1DLE1BQU4sRUFBSixDQUNDLEtBQU0sSUFBSVQscUJBQUosQ0FBZ0JOLG1DQUFoQixDQUFxRCxxQ0FBckQsQ0FBTixDQUVELEdBQUksQ0FBQ0ssQ0FBTSxDQUFDVyxXQUFaLENBQ0MsS0FBTSxJQUFJVixxQkFBSixDQUFnQk4sbUNBQWhCLENBQXFELCtCQUFyRCxDQUFOLENBRUQsS0FBS2lCLGNBQUwsQ0FBc0IsR0FBSUMsd0JBQUosQ0FBbUJiLENBQU0sQ0FBQ1csV0FBMUIsQ0FDdEIsQ0FFRCxLQUFLWCxNQUFMLENBQWNBLENBQ2QsQ0FFRDs7OztHQUtBRCxZQUFZLENBQUNlLFNBQWIsQ0FBdUJDLGVBQXZCLHNGQUF5QyxXQUFlQyxDQUFmLGdIQUVuQixLQUFLQyxlQUFMLENBQXFCRCxDQUFyQixDQUZtQixjQUVuQ0UsQ0FBQUEsQ0FGbUMsMEJBR2hDLEtBQUFBLENBQU8sQ0FBQ0MsUUFBUixDQUFpQkMsTUFIZSw4REFLaENDLE9BQU8sQ0FBQ0MsTUFBUixNQUxnQyx1REFBekMsdUQsQ0FhQXZCLFlBQVksQ0FBQ2UsU0FBYixDQUF1QkcsZUFBdkIsQ0FBeUMsU0FBU00sQ0FBVCxDQUFtQixDQUMzRCxHQUFJUCxDQUFBQSxDQUFLLENBQUdPLENBQVEsRUFBSSxLQUFLUCxLQUE3QixDQUNBLEdBQUksQ0FBQ1AsZUFBTWUsT0FBTixDQUFjRCxDQUFkLENBQUwsQ0FDQyxNQUFPRixDQUFBQSxPQUFPLENBQUNDLE1BQVIsQ0FBZSxHQUFJckIscUJBQUosQ0FBZ0JILFdBQWhCLENBQTZCLHNDQUE3QixDQUFmLENBQVAsQ0FIMEQsR0FNdkQyQixDQUFBQSxDQUFJLFdBQU0sS0FBS3pCLE1BQUwsQ0FBWUcsU0FBbEIscUNBTm1ELENBUXZEdUIsQ0FBSSxDQUFHLENBQ1ZDLFNBQVMsQ0FBRSxLQUFLM0IsTUFBTCxDQUFZRSxRQURiLENBRVYwQixhQUFhLENBQUUsS0FBSzVCLE1BQUwsQ0FBWVEsWUFGakIsQ0FHVlEsS0FBSyxDQUFFQSxDQUFLLENBQUNhLFlBSEgsQ0FSZ0QsQ0FjdkRDLENBQVcsQ0FBR0MscUJBQUdDLFNBQUgsQ0FBYU4sQ0FBYixDQWR5QyxDQXVCM0QsTUFBTyxNQUFLTyxjQUFMLENBUE8sQ0FDYkMsTUFBTSxDQUFFLE1BREssQ0FFYkMsR0FBRyxDQUFFVixDQUZRLENBR2JXLFdBQVcsQ0FBRSxtQ0FIQSxDQUliVixJQUFJLENBQUVJLENBSk8sQ0FPUCxDQUE2QmQsQ0FBN0IsQ0FDUCxDLENBTURqQixZQUFZLENBQUNlLFNBQWIsQ0FBdUJ1QixRQUF2QixDQUFrQyxTQUFTZCxDQUFULENBQW1CLENBQ3BELEdBQUlQLENBQUFBLENBQUssQ0FBR08sQ0FBUSxFQUFJLEtBQUtQLEtBQTdCLENBRUEsR0FBSSxDQUFDUCxlQUFNZSxPQUFOLENBQWNSLENBQWQsQ0FBTCxDQUNDLE1BQU9LLENBQUFBLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLEdBQUlyQixxQkFBSixDQUFnQkgsV0FBaEIsQ0FBNkIsc0NBQTdCLENBQWYsQ0FBUCxDQUptRCxHQVFoRDJCLENBQUFBLENBQUksV0FBTSxLQUFLekIsTUFBTCxDQUFZRyxTQUFsQixtQ0FSNEMsQ0FVaERtQyxDQUFPLENBQUcsQ0FDYkosTUFBTSxDQUFFLE1BREssQ0FFYkMsR0FBRyxDQUFFVixDQUZRLENBR2JXLFdBQVcsQ0FBRSxtQ0FIQSxDQUliVixJQUFJLENBQUVLLHFCQUFHQyxTQUFILENBQWFoQixDQUFLLENBQUNhLFlBQW5CLENBSk8sQ0FWc0MsQ0FpQnBELE1BQU8sTUFBS0ksY0FBTCxDQUFvQkssQ0FBcEIsQ0FBNkJ0QixDQUE3QixDQUNQLEMsQ0FNRGpCLFlBQVksQ0FBQ2UsU0FBYixDQUF1QnlCLFVBQXZCLENBQW9DLFVBQVcsQ0FDOUMsR0FBNkIsVUFBekIsUUFBS3ZDLE1BQUwsQ0FBWUssUUFBaEIsQ0FDQyxHQUFJLENBQ0gsR0FBSW1DLENBQUFBLENBQVcsQ0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVcsS0FBSzlCLGNBQUwsQ0FBb0IrQixVQUFwQixDQUErQixPQUEvQixDQUFYLENBQWxCLENBQ0EsTUFBT0gsQ0FBQUEsQ0FDUCxDQUFDLE1BQU9JLENBQVAsQ0FBYyxDQUNmLE1BQU8sS0FDUCxDQU5GLElBUUMsTUFBTSxJQUFJM0MscUJBQUosQ0FBZ0JKLHVCQUFoQixDQUF5QyxrREFBekMsQ0FFUCxDLENBTURFLFlBQVksQ0FBQ2UsU0FBYixDQUF1QitCLFNBQXZCLENBQW1DLFVBQVcsQ0FDN0MsTUFBTyxNQUFLN0MsTUFDWixDLENBT0RELFlBQVksQ0FBQ2UsU0FBYixDQUF1QmdDLE1BQXZCLHNGQUFnQyxXQUFlckIsQ0FBZixDQUFxQlQsQ0FBckIsc0dBRUYsVUFBekIsUUFBS2hCLE1BQUwsQ0FBWUssUUFGZSx3QkFHMUJtQyxDQUFBQSxDQUgwQixDQUdaLEtBQUtELFVBQUwsRUFIWSxVQUl4QixLQUFLUSxXQUFMLENBQWlCUCxDQUFqQixDQUE4QixjQUE5QixDQUp3Qix3QkFLeEIsS0FBSzVCLGNBQUwsQ0FBb0JvQyxZQUFwQixFQUx3Qix3QkFNeEJDLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0IxQixDQUFJLEVBQUksR0FBaEMsQ0FOd0IsZ0NBU0wsQ0FBckIsS0FBVTJCLE1BQVYsRUFBMkIzQyxlQUFNZSxPQUFOLENBQWNSLENBQWQsQ0FURCxFQVU3QkssT0FBTyxDQUFDQyxNQUFSLENBQWUsR0FBSXJCLHFCQUFKLENBQWdCSCxXQUFoQixDQUE2QixvQkFBN0IsQ0FBZixDQVY2QixDQWFMLENBQXJCLEtBQVVzRCxNQUFWLEVBQTJCM0MsZUFBTWUsT0FBTixDQUFjQyxDQUFkLENBYkQsRUFjN0JKLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLEdBQUlyQixxQkFBSixDQUFnQkgsV0FBaEIsQ0FBNkIsb0JBQTdCLENBQWYsQ0FkNkIsQ0FpQkwsQ0FBckIsS0FBVXNELE1BakJnQixDQWtCN0IsS0FBS0wsV0FBTCxDQUFpQi9CLENBQWpCLENBQXdCLGNBQXhCLENBbEI2QixDQW9CN0IsS0FBSytCLFdBQUwsQ0FBaUJ0QixDQUFqQixDQUF1QixjQUF2QixDQXBCNkIsOENBQWhDLHVELENBOEJBMUIsWUFBWSxDQUFDZSxTQUFiLENBQXVCaUMsV0FBdkIsQ0FBcUMsU0FBUy9CLENBQVQsQ0FBZ0JxQyxDQUFoQixDQUEyQixJQUUzREMsQ0FBQUEsQ0FGMkQsQ0FHM0R4QixDQUgyRCxDQUkzRFEsQ0FKMkQsQ0FDM0RiLENBQUksV0FBTSxLQUFLekIsTUFBTCxDQUFZRyxTQUFsQixpQ0FEdUQsQ0FNL0QsR0FBdUIsQ0FBbkIsQ0FBQW9ELFNBQVMsQ0FBQ0gsTUFBZCxDQUNDLEtBQU0sSUFBSW5ELHFCQUFKLENBQWdCSix1QkFBaEIsQ0FBeUMsNERBQThEMEQsU0FBUyxDQUFDSCxNQUF4RSxDQUFpRixhQUExSCxDQUFOLENBR0QsR0FBSSxDQUFDcEMsQ0FBTCxDQUNDLEtBQU0sSUFBSWYscUJBQUosQ0FBZ0JKLHVCQUFoQixDQUF5QyxzQkFBekMsQ0FBTixDQUdELEdBQW9CLGNBQWQsR0FBQXdELENBQVMsRUFBcUMsZUFBZCxHQUFBQSxDQUF0QyxDQUNDLEtBQU0sSUFBSXBELHFCQUFKLENBQWdCSix1QkFBaEIsc0JBQXVEd0QsQ0FBdkQsNEVBQU4sQ0FHREMsQ0FBVyxDQUFpQixjQUFkLEdBQUFELENBQVMsQ0FBc0JyQyxDQUFLLENBQUNhLFlBQTVCLENBQTJDYixDQUFLLENBQUN3QyxhQWxCVCxDQW9CL0QsR0FBSTlCLENBQUFBLENBQUksQ0FBRyxDQUNWQyxTQUFTLENBQUUsS0FBSzNCLE1BQUwsQ0FBWUUsUUFEYixDQUVWMEIsYUFBYSxDQUFFLEtBQUs1QixNQUFMLENBQVlRLFlBRmpCLENBR1ZRLEtBQUssQ0FBRXNDLENBSEcsQ0FBWCxDQWVBO0FBQ0EsTUFWQXhCLENBQUFBLENBQVcsQ0FBR0MscUJBQUdDLFNBQUgsQ0FBYU4sQ0FBYixDQVVkLENBUkFZLENBQU8sQ0FBRyxDQUNUSixNQUFNLENBQUUsTUFEQyxDQUVURSxXQUFXLENBQUUsbUNBRkosQ0FHVEQsR0FBRyxDQUFFVixDQUhJLENBSVRDLElBQUksQ0FBRUksQ0FKRyxDQVFWLENBQU8sS0FBS0csY0FBTCxDQUFvQkssQ0FBcEIsQ0FBNkJ0QixDQUE3QixDQUNQLEMsQ0FPRGpCLFlBQVksQ0FBQ2UsU0FBYixDQUF1QjJDLGFBQXZCLENBQXVDLFNBQVNDLENBQVQsQ0FBcUIsQ0FDM0QsR0FBSUMsQ0FBQUEsQ0FBVSxDQUFHNUIscUJBQUdXLEtBQUgsQ0FBU2dCLENBQVQsQ0FBakIsQ0FDQSxNQUFPQyxDQUFBQSxDQUNQLEMsQ0FNRDVELFlBQVksQ0FBQ2UsU0FBYixDQUF1QjhDLFdBQXZCLENBQXFDLFVBQVcsWUFDL0MsR0FBSW5ELGVBQU1DLE1BQU4sRUFBSixDQUNDLEtBQU0sSUFBSVQscUJBQUosQ0FBZ0JKLHVCQUFoQixDQUF5Qyx3Q0FBekMsQ0FBTixDQUY4QyxHQUl6Q2dFLENBQUFBLENBQVMsQ0FBR3BCLElBQUksQ0FBQ0MsS0FBTCxDQUFXLEtBQUs5QixjQUFMLENBQW9CK0IsVUFBcEIsQ0FBK0IsT0FBL0IsQ0FBWCxFQUFvRG1CLFVBSnZCLENBS3pDQyxDQUFTLENBQUduRSxrQkFBVW9FLGtCQUxtQixDQU16Q0MsQ0FBSyxDQUFHSixDQUFTLEVBQUlLLElBQUksQ0FBQ0MsR0FBTCxHQUFhSixDQUFqQixDQU53QixDQVFuQyxDQUFSLENBQUFFLENBUjJDLEVBUzlDRyxVQUFVLENBQUMsVUFBTSxDQUNoQixDQUFJLENBQUNDLE9BQUwsR0FEZ0IsQ0FFaEIsQ0FBSSxDQUFDekQsY0FBTCxDQUFvQm9DLFlBQXBCLEVBQ0EsQ0FIUyxDQUdQaUIsQ0FITyxDQUtYLEMsQ0FRRGxFLFlBQVksQ0FBQ2UsU0FBYixDQUF1QndELFFBQXZCLENBQWtDLFNBQVNDLENBQVQsQ0FBaUIsQ0FDbEQsR0FBNkIsVUFBekIsUUFBS3ZFLE1BQUwsQ0FBWUssUUFBaEIsQ0FDQyxLQUFNLElBQUlKLHFCQUFKLENBQWdCSix1QkFBaEIsQ0FBeUMsOENBQXpDLENBQU4sQ0FFRCxHQUFJLENBQUMwRSxDQUFMLENBQ0M7QUFDQSxLQUFNLElBQUl0RSxxQkFBSixDQUFnQkosdUJBQWhCLENBQXlDLHVDQUF6QyxDQUFOLENBTmlELEdBUzlDMkUsQ0FBQUEsQ0FBSyxDQUdvQixvQkFBekIsUUFBS3hFLE1BQUwsQ0FBWUssUUFIUCxDQUNLa0UsQ0FETCxDQU1BQSxDQUFNLENBQUNFLFNBQVAsQ0FBaUJGLENBQU0sQ0FBQ0csT0FBUCxDQUFlLEdBQWYsQ0FBakIsQ0FmeUMsSUFtQjlDaEQsQ0FBQUEsQ0FBSSxDQUFvQixRQUFqQixXQUFPOEMsQ0FBUCxFQUE0QkEsQ0FBNUIsQ0FBb0N6QyxxQkFBR1csS0FBSCxDQUFTOEIsQ0FBVCxDQW5CRyxDQW9COUMvQyxDQUFJLFdBQU0sS0FBS3pCLE1BQUwsQ0FBWUcsU0FBbEIsZ0NBcEIwQyxDQXNCckIsb0JBQXpCLFFBQUtILE1BQUwsQ0FBWUssUUF0QmtDLENBdUJqRHFCLENBQUksQ0FBQ2lELFVBQUwsQ0FBa0IsS0FBSzNFLE1BQUwsQ0FBWUssUUF2Qm1CLEVBeUJqRHFCLENBQUksQ0FBQ2tELFlBQUwsQ0FBb0IsS0FBSzVFLE1BQUwsQ0FBWUksV0F6QmlCLENBMEJqRHNCLENBQUksQ0FBQ2lELFVBQUwsQ0FBa0Isb0JBMUIrQixFQTZCbERqRCxDQUFJLENBQUNDLFNBQUwsQ0FBaUIsS0FBSzNCLE1BQUwsQ0FBWUUsUUE3QnFCLENBOEJsRHdCLENBQUksQ0FBQ0UsYUFBTCxDQUFxQixLQUFLNUIsTUFBTCxDQUFZUSxZQTlCaUIsQ0ErQmxEa0IsQ0FBSSxDQUFDbkIsS0FBTCxDQUFhLEtBQUtQLE1BQUwsQ0FBWU8sS0EvQnlCLElBaUM5Q3VCLENBQUFBLENBQVcsQ0FBR0MscUJBQUdDLFNBQUgsQ0FBYU4sQ0FBYixDQWpDZ0MsQ0EwQ2xELE1BQU8sd0JBUE8sQ0FDYlEsTUFBTSxDQUFFLE1BREssQ0FFYkMsR0FBRyxDQUFFVixDQUZRLENBR2JXLFdBQVcsQ0FBRSxtQ0FIQSxDQUliVixJQUFJLENBQUVJLENBSk8sQ0FPUCxDQUNQLEMsQ0FRRC9CLFlBQVksQ0FBQ2UsU0FBYixDQUF1QitELFlBQXZCLENBQXNDLFNBQVM3RCxDQUFULENBQWdCLENBQ3JELEdBQTZCLFVBQXpCLFFBQUtoQixNQUFMLENBQVlLLFFBQWhCLENBQ0MsTUFBT2dCLENBQUFBLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLEdBQUlyQixxQkFBSixDQUFnQkosdUJBQWhCLENBQXlDLDhDQUF6QyxDQUFmLENBQVAsQ0FHRCxHQUFJLENBQUNtQixDQUFLLENBQUM4RCxjQUFOLENBQXFCLGVBQXJCLENBQUwsQ0FDQyxNQUFPekQsQ0FBQUEsT0FBTyxDQUFDQyxNQUFSLENBQWUsR0FBSXJCLHFCQUFKLENBQWdCSix1QkFBaEIsQ0FBeUMsdUNBQXpDLENBQWYsQ0FBUCxDQU5vRCxHQVNqRDRCLENBQUFBLENBQUksV0FBTSxLQUFLekIsTUFBTCxDQUFZRyxTQUFsQixnQ0FUNkMsQ0FVakR1QixDQUFJLENBQUcsQ0FDVjhCLGFBQWEsQ0FBRXhDLENBQUssQ0FBQ3dDLGFBRFgsQ0FFVjdCLFNBQVMsQ0FBRSxLQUFLM0IsTUFBTCxDQUFZRSxRQUZiLENBR1YwQixhQUFhLENBQUUsS0FBSzVCLE1BQUwsQ0FBWVEsWUFIakIsQ0FJVm1FLFVBQVUsQ0FBRSxlQUpGLENBS1ZwRSxLQUFLLENBQUUsS0FBS1AsTUFBTCxDQUFZTyxLQUxULENBVjBDLENBa0JqRHVCLENBQVcsQ0FBR0MscUJBQUdDLFNBQUgsQ0FBYU4sQ0FBYixDQWxCbUMsQ0EyQnJELE1BQU8sd0JBUE8sQ0FDYlEsTUFBTSxDQUFFLE1BREssQ0FFYkMsR0FBRyxDQUFFVixDQUZRLENBR2JXLFdBQVcsQ0FBRSxtQ0FIQSxDQUliVixJQUFJLENBQUVJLENBSk8sQ0FPUCxDQUNQLEMsQ0FFRC9CLFlBQVksQ0FBQ2UsU0FBYixDQUF1QmlFLFVBQXZCLENBQW9DLFNBQVN6QyxDQUFULENBQWtCLENBQ3JELE1BQU8sTUFBSzBDLFNBQUwsQ0FBZTFDLENBQWYsQ0FDUCxDLENBUUR2QyxZQUFZLENBQUNlLFNBQWIsQ0FBdUJtRSxLQUF2QixDQUErQixVQUFXLENBQ3pDLEdBQUk5QyxDQUFBQSxDQUFHLENBQUcsS0FBSzRDLFVBQUwsQ0FBZ0IsS0FBSy9FLE1BQXJCLENBQVYsQ0FDQSxNQUFPbUMsQ0FBQUEsQ0FDUCxDLENBUURwQyxZQUFZLENBQUNlLFNBQWIsQ0FBdUJrRSxTQUF2QixDQUFtQyxTQUFTRSxDQUFULENBQWUsQ0FDakQsTUFDQ0EsQ0FBQUEsQ0FBSSxDQUFDL0UsU0FBTCxDQUNBLG1DQURBLENBRUE0QixxQkFBR0MsU0FBSCxDQUFhLENBQ1pMLFNBQVMsQ0FBRXVELENBQUksQ0FBQ2hGLFFBREosQ0FFWjBFLFlBQVksQ0FBRU0sQ0FBSSxDQUFDOUUsV0FGUCxDQUdaRyxLQUFLLENBQUUyRSxDQUFJLENBQUMzRSxLQUhBLENBSVo0RSxhQUFhLENBQUVELENBQUksQ0FBQzVFLFlBSlIsQ0FLWjhFLEtBQUssQ0FBRTNFLGVBQU00RSxZQUFOLENBQW1CLEVBQW5CLENBTEssQ0FNWkMsS0FBSyxDQUFFN0UsZUFBTTRFLFlBQU4sQ0FBbUIsRUFBbkIsQ0FOSyxDQUFiLENBU0QsQyxDQU1EdEYsWUFBWSxDQUFDZSxTQUFiLENBQXVCeUUsWUFBdkIsQ0FBc0MsVUFBVyxDQUNoRCxNQUFPLElBQUlsRSxDQUFBQSxPQUFKLENBQ04sU0FBU21FLENBQVQsQ0FBa0IsQ0FDakJBLENBQU8sQ0FBQyxLQUFLVCxVQUFMLENBQWdCLEtBQUsvRSxNQUFyQixDQUFELENBQ1AsQ0FGRCxDQUVFeUYsSUFGRixDQUVPLElBRlAsQ0FETSxDQUtQLEMsQ0FRRDFGLFlBQVksQ0FBQ2UsU0FBYixDQUF1QjRFLFVBQXZCLENBQW9DLFNBQVNoQyxDQUFULENBQXFCLENBQ3hELEdBQUlDLENBQUFBLENBQVUsQ0FBRzVCLHFCQUFHVyxLQUFILENBQVNnQixDQUFULENBQWpCLENBQ0EsTUFBT0MsQ0FBQUEsQ0FDUCxDLENBT0Q1RCxZQUFZLENBQUNlLFNBQWIsQ0FBdUJtQixjQUF2QixzRkFBd0MsV0FBZUssQ0FBZixDQUF3QmYsQ0FBeEIsZ0hBQ2hCLENBQW5CLEdBQVU2QixNQUR5Qix1QkFFaEMsSUFBSW5ELHFCQUFKLENBQWdCSix1QkFBaEIsQ0FBeUMsNkRBQStELEVBQVV1RCxNQUF6RSxDQUFrRixhQUEzSCxDQUZnQyxXQUlsQzNDLGVBQU1lLE9BQU4sQ0FBY0QsQ0FBZCxDQUprQywwQ0FLL0JGLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLEdBQUlyQixxQkFBSixDQUFnQkgsV0FBaEIsQ0FBNkIsbUJBQTdCLENBQWYsQ0FMK0IsZUFRbkNrQixDQUFBQSxDQVJtQyxDQVEzQk8sQ0FSMkIsQ0FVbkNMLENBVm1DLENBVXpCLENBQ2JDLFFBQVEsQ0FBRSxJQURHLENBRWJILEtBQUssQ0FBRSxJQUZNLENBVnlCLG1CQWdCakIsd0JBQVdzQixDQUFYLENBQW9CdEIsQ0FBSyxDQUFDYSxZQUExQixDQWhCaUIsV0FnQmxDVixDQWhCa0MsUUFpQnRDRCxDQUFPLENBQUNDLFFBQVIsQ0FBbUJBLENBakJtQixDQWtCVCxVQUF6QixRQUFLbkIsTUFBTCxDQUFZSyxRQWxCc0IsMkNBbUI5QmdCLE9BQU8sQ0FBQ21FLE9BQVIsQ0FBZ0JyRSxDQUFoQixDQW5COEIsbUNBcUIvQkUsT0FBTyxDQUFDbUUsT0FBUixDQUFnQnRFLENBQWhCLENBckIrQiw0Q0F1QmpCLEdBQWpCLFFBQU15RSxNQUFOLEVBQXdCbEYsZUFBTUMsTUFBTixFQXZCVSxzQkF5QmhDTSxDQUFLLENBQUN3QyxhQXpCMEIsMkNBMEI3Qm5DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLEdBQUlyQixxQkFBSixDQUFnQkosdUJBQWhCLENBQXlDLGtEQUF6QyxDQUFmLENBMUI2QiwyQkE0QmhCLEtBQUtnRixZQUFMLENBQWtCN0QsQ0FBbEIsQ0E1QmdCLGVBNEJqQzRFLENBQUFBLENBNUJpQyxrQkE2QlQsd0JBQVd0RCxDQUFYLENBQW9Cc0QsQ0FBUSxDQUFDL0QsWUFBN0IsQ0E3QlMsZUE2QmpDZ0UsQ0FBQUEsQ0E3QmlDLFFBOEJyQzNFLENBQU8sQ0FBRyxDQUNUQyxRQUFRLENBQUUwRSxDQURELENBRVQ3RSxLQUFLLENBQUU0RSxDQUZFLENBOUIyQixtQkFrQzlCdkUsT0FBTyxDQUFDbUUsT0FBUixDQUFnQnRFLENBQWhCLENBbEM4QixtQ0FvQy9CRyxPQUFPLENBQUNDLE1BQVIsTUFwQytCLHdEQUF4Qyx1RCxDQTRDQXZCLFlBQVksQ0FBQ2UsU0FBYixDQUF1QmdGLGNBQXZCLENBQXdDLFVBQVcsQ0FDbEQsR0FBSXJGLGVBQU1DLE1BQU4sRUFBSixDQUNDLEtBQU0sSUFBSVQscUJBQUosQ0FBZ0JKLHVCQUFoQixDQUF5Qyw0Q0FBekMsQ0FBTixDQUZpRCxHQUk5Q2tHLENBQUFBLENBSjhDLENBSzlDQyxDQUFVLFNBTG9DLENBTTlDQyxDQUFJLENBQUdoRCxNQUFNLENBQUNDLFFBQVAsQ0FBZ0IrQyxJQU51QixDQVVsRCxNQUZBRixDQUFBQSxDQUFNLENBQW1CLFFBQWhCLFdBQU9FLENBQVAsRUFBMkJBLENBQTNCLENBQWtDLEtBQUt4QyxhQUFMLENBQW1Cd0MsQ0FBbkIsQ0FFM0MsQ0FBTyxHQUFJNUUsQ0FBQUEsT0FBSixDQUFZLFNBQVNDLENBQVQsQ0FBaUIsQ0FDL0IwRSxDQUFVLENBQUNFLElBQVgsQ0FBZ0JELENBQWhCLENBRCtCLENBRWxDM0UsQ0FBTSxDQUFDeUUsQ0FBRCxDQUY0QixFQUlsQyxLQUFLbkYsY0FBTCxDQUFvQnVGLFVBQXBCLENBQStCSixDQUEvQixDQUprQyxDQUtsQyxLQUFLbkMsV0FBTCxFQUxrQyxDQU9sQ1gsTUFBTSxDQUFDQyxRQUFQLENBQWdCK0MsSUFBaEIsQ0FBdUIsRUFQVyxDQVNuQyxDQVRrQixDQVNqQlIsSUFUaUIsQ0FTWixJQVRZLENBQVosQ0FVUCxDLGNBRWMxRixZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdAYmFiZWwvcG9seWZpbGwnO1xuaW1wb3J0IHFzIGZyb20gJ3F1ZXJ5LXN0cmluZyc7XG5pbXBvcnQgVmVyaWZ5RXJyb3IgZnJvbSAnLi9lcnJvcnMvVmVyaWZ5RXJyb3InO1xuaW1wb3J0IFN0b3JhZ2VIYW5kbGVyIGZyb20gJy4vaGVscGVycy9TdG9yYWdlSGFuZGxlcic7XG5pbXBvcnQgeyBBcHBDb25maWcgfSBmcm9tICcuL2NvbmZpZyc7XG5pbXBvcnQgYXBpUmVxdWVzdCBmcm9tICcuL2hlbHBlcnMvYXBpUmVxdWVzdCc7XG5pbXBvcnQgdXRpbHMgZnJvbSAnLi9oZWxwZXJzL3V0aWxzJztcblxuY29uc3Qge1xuXHRPQVVUSF9DT05URVhUX0NPTkZJR19TRVRUSU5HU19FUlJPUixcblx0T0FVVEhfQ09OVEVYVF9BUElfRVJST1IsXG5cdFRPS0VOX0VSUk9SXG59ID0gQXBwQ29uZmlnO1xuLyoqXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IGNvbmZpZyB1c2VycyBjb25maWd1cmF0aW9uIHNldHRpbmdzIHRvIGtpY2sgb2ZmXG4gKiBPQXV0aCBpbXBsaWNpdCBmbG93XG4gKi9cbmZ1bmN0aW9uIE9BdXRoQ29udGV4dChjb25maWcpIHtcblx0aWYgKCFjb25maWcpIHtcblx0XHR0aHJvdyBuZXcgVmVyaWZ5RXJyb3IoT0FVVEhfQ09OVEVYVF9DT05GSUdfU0VUVElOR1NfRVJST1IsICdDb25maWcgcGFyYW1ldGVyIGlzIHJlcXVpcmVkJyk7XG5cdH1cblx0Ly9WZXJpZnkgY29uZmlnIHNldHRpbmdzXG5cdGlmICghY29uZmlnLmNsaWVudElkKSB7XG5cdFx0dGhyb3cgbmV3IFZlcmlmeUVycm9yKE9BVVRIX0NPTlRFWFRfQ09ORklHX1NFVFRJTkdTX0VSUk9SLCAnY2xpZW50SWQgcHJvcGVydHkgaXMgcmVxdWlyZWQnKTtcblx0fVxuXHRpZiAoIWNvbmZpZy50ZW5hbnRVcmwpIHtcblx0XHR0aHJvdyBuZXcgVmVyaWZ5RXJyb3IoT0FVVEhfQ09OVEVYVF9DT05GSUdfU0VUVElOR1NfRVJST1IsICdUZW5hbnQgVVJMIGlzIHJlcXVpcmVkJyk7XG5cdH1cblx0aWYgKCFjb25maWcucmVkaXJlY3RVcmkgJiYgY29uZmlnLmZsb3dUeXBlICE9PSAnY2xpZW50X2NyZWRlbnRpYWxzJykge1xuXHRcdHRocm93IG5ldyBWZXJpZnlFcnJvcihPQVVUSF9DT05URVhUX0NPTkZJR19TRVRUSU5HU19FUlJPUiwgJ0EgcmVkaXJlY3QgVVJMIGlzIHJlcXVpcmVkJyk7XG5cdH1cblx0aWYgKCFjb25maWcucmVzcG9uc2VUeXBlICYmIGNvbmZpZy5mbG93VHlwZSAhPT0gJ2NsaWVudF9jcmVkZW50aWFscycpIHtcblx0XHR0aHJvdyBuZXcgVmVyaWZ5RXJyb3IoT0FVVEhfQ09OVEVYVF9DT05GSUdfU0VUVElOR1NfRVJST1IsICdSZXNwb25zZSBUeXBlIHJlcXVpcmVkJyk7XG5cdH1cblx0aWYgKCFjb25maWcuc2NvcGUpIHtcblx0XHR0aHJvdyBuZXcgVmVyaWZ5RXJyb3IoT0FVVEhfQ09OVEVYVF9DT05GSUdfU0VUVElOR1NfRVJST1IsICdzY29wZSBQcm9wZXJ0eSBub3Qgc2V0IGluIENvbmZpZyBzZXR0aW5ncycpO1xuXHR9XG5cdGlmIChjb25maWcuZmxvd1R5cGUgPT09ICdBWk4nICYmICFjb25maWcuY2xpZW50U2VjcmV0KSB7XG5cdFx0dGhyb3cgbmV3IFZlcmlmeUVycm9yKE9BVVRIX0NPTlRFWFRfQ09ORklHX1NFVFRJTkdTX0VSUk9SLCAnQ2xpZW50IFNlY3JldCBpcyByZXF1aXJlZCBmb3IgdGhlIEFaTiBjb2RlIGZsb3cnKTtcblx0fVxuXG5cdGlmICghKGNvbmZpZy5mbG93VHlwZSA9PT0gJ0ltcGxpY2l0JyB8fCBjb25maWcuZmxvd1R5cGUgPT09ICdBWk4nIHx8IGNvbmZpZy5mbG93VHlwZSA9PT0gJ2NsaWVudF9jcmVkZW50aWFscycpKSB7XG5cdFx0dGhyb3cgbmV3IFZlcmlmeUVycm9yKE9BVVRIX0NPTlRFWFRfQ09ORklHX1NFVFRJTkdTX0VSUk9SLCAnQ2hlY2sgdGhlIGZsb3dUeXBlIHByb3BlcnR5IGluIHlvdXIgY29uZmlndXJhdGlvbiBvYmplY3QgaXMgY29ycmVjdC4gU3VwcG9ydGVkIFZhbHVlczogXCJJbXBsaWNpdFwiLCBcIkFaTlwiLCBcImNsaWVudF9jcmVkZW50aWFsc1wiJyk7XG5cdH1cblxuXHRpZiAoY29uZmlnLmZsb3dUeXBlID09PSAnSW1wbGljaXQnKSB7XG5cdFx0aWYgKHV0aWxzLmlzTm9kZSgpKSB7XG5cdFx0XHR0aHJvdyBuZXcgVmVyaWZ5RXJyb3IoT0FVVEhfQ09OVEVYVF9DT05GSUdfU0VUVElOR1NfRVJST1IsICdJbXBsaWNpdCBmbG93IG5vdCBzdXBwb3J0ZWQgaW4gTm9kZScpO1xuXHRcdH1cblx0XHRpZiAoIWNvbmZpZy5zdG9yYWdlVHlwZSkge1xuXHRcdFx0dGhyb3cgbmV3IFZlcmlmeUVycm9yKE9BVVRIX0NPTlRFWFRfQ09ORklHX1NFVFRJTkdTX0VSUk9SLCAnc3RvcmFnZVR5cGUgcHJvcGVydHkgbm90IHNldC4nKTtcblx0XHR9XG5cdFx0dGhpcy5zdG9yYWdlSGFuZGxlciA9IG5ldyBTdG9yYWdlSGFuZGxlcihjb25maWcuc3RvcmFnZVR5cGUpO1xuXHR9XG5cblx0dGhpcy5jb25maWcgPSBjb25maWc7XG59XG5cbi8qKlxuICogQGZ1bmN0aW9uIGlzQXV0aGVudGljYXRlZCB0byBjaGVjayBjdXJyZW50IHVzZXJzIGFjY2Vzc190b2tlbiBvciByZWZyZXNoX3Rva2VuIHRvXG4gKiBkZXRlcm1pbmUgaWYgdGhleSBhcmUgc3RpbGwgdmFsaWQuXG4gKiBAcGFyYW0ge29iamVjdH0gdG9rZW4gdGhlIHRva2VuIG9iamVjdCB3aXRoIGFjY2Vzc190b2tlbiwgcmVmcmVzaFRva2VuIGV0Yy5cbiAqL1xuT0F1dGhDb250ZXh0LnByb3RvdHlwZS5pc0F1dGhlbnRpY2F0ZWQgPSBhc3luYyBmdW5jdGlvbih0b2tlbikge1xuXHR0cnkge1xuXHRcdGxldCBwYXlsb2FkID0gYXdhaXQgdGhpcy5pbnRyb3NwZWN0VG9rZW4odG9rZW4pO1xuXHRcdHJldHVybiBwYXlsb2FkLnJlc3BvbnNlLmFjdGl2ZSA9PT0gdHJ1ZTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuXHR9XG59O1xuXG4vKipcbiAqIEBmdW5jdGlvbiBpbnRyb3NwZWN0VG9rZW4gdG8gaW5zcGVjdCBhbiBPSURDIHRva2VuLlxuICogQHBhcmFtIHtvYmplY3R9IHRva2VuIHRva2VuIG9iamVjdCB0byBpbnRyb3NwZWN0XG4gKi9cbk9BdXRoQ29udGV4dC5wcm90b3R5cGUuaW50cm9zcGVjdFRva2VuID0gZnVuY3Rpb24odG9rZW5PYmopIHtcblx0bGV0IHRva2VuID0gdG9rZW5PYmogfHwgdGhpcy50b2tlbjtcblx0aWYgKCF1dGlscy5pc1Rva2VuKHRva2VuT2JqKSkge1xuXHRcdHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVmVyaWZ5RXJyb3IoVE9LRU5fRVJST1IsICdUb2tlbiBwYXJhbWV0ZXIgaXMgbm90IGEgdmFsaWQgdG9rZW4nKSk7XG5cdH1cblxuXHRsZXQgcGF0aCA9IGAke3RoaXMuY29uZmlnLnRlbmFudFVybH0vdjEuMC9lbmRwb2ludC9kZWZhdWx0L2ludHJvc3BlY3RgO1xuXG5cdGxldCBkYXRhID0ge1xuXHRcdGNsaWVudF9pZDogdGhpcy5jb25maWcuY2xpZW50SWQsXG5cdFx0Y2xpZW50X3NlY3JldDogdGhpcy5jb25maWcuY2xpZW50U2VjcmV0LFxuXHRcdHRva2VuOiB0b2tlbi5hY2Nlc3NfdG9rZW5cblx0fTtcblxuXHRsZXQgZW5jb2RlZERhdGEgPSBxcy5zdHJpbmdpZnkoZGF0YSk7XG5cblx0bGV0IG9wdGlvbnMgPSB7XG5cdFx0bWV0aG9kOiAnUE9TVCcsXG5cdFx0dXJsOiBwYXRoLFxuXHRcdGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcblx0XHRkYXRhOiBlbmNvZGVkRGF0YVxuXHR9O1xuXG5cdHJldHVybiB0aGlzLmhhbmRsZVJlc3BvbnNlKG9wdGlvbnMsIHRva2VuKTtcbn07XG5cbi8qKlxuICogQGZ1bmN0aW9uIHVzZXJpbmZvIEFQSSB0byBnZXQgdGhlIHVzZXIgaW5mb3JtYXRpb24gdGhhdCBpcyBhc3NvY2lhdGVkIHdpdGggdGhlIHRva2VuIHBhcmFtZXRlclxuICogQHBhcmFtIHtvYmplY3R9IHRva2VuT2JqIHRva2VuIG9iamVjdCB3aXRoIGFjY2Vzc190b2tlbiBwcm9wZXJ0eS5cbiAqL1xuT0F1dGhDb250ZXh0LnByb3RvdHlwZS51c2VyaW5mbyA9IGZ1bmN0aW9uKHRva2VuT2JqKSB7XG5cdGxldCB0b2tlbiA9IHRva2VuT2JqIHx8IHRoaXMudG9rZW47XG5cblx0aWYgKCF1dGlscy5pc1Rva2VuKHRva2VuKSkge1xuXHRcdHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVmVyaWZ5RXJyb3IoVE9LRU5fRVJST1IsICdUb2tlbiBwYXJhbWV0ZXIgaXMgbm90IGEgdmFsaWQgdG9rZW4nKSk7XG5cdH1cblxuXG5cdGxldCBwYXRoID0gYCR7dGhpcy5jb25maWcudGVuYW50VXJsfS92MS4wL2VuZHBvaW50L2RlZmF1bHQvdXNlcmluZm9gO1xuXG5cdGxldCBvcHRpb25zID0ge1xuXHRcdG1ldGhvZDogJ1BPU1QnLFxuXHRcdHVybDogcGF0aCxcblx0XHRjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG5cdFx0ZGF0YTogcXMuc3RyaW5naWZ5KHRva2VuLmFjY2Vzc190b2tlbilcblx0fTtcblxuXHRyZXR1cm4gdGhpcy5oYW5kbGVSZXNwb25zZShvcHRpb25zLCB0b2tlbik7XG59O1xuXG5cbi8qKlxuICogQGZ1bmN0aW9uIGZldGNoVG9rZW4gVXNlZCBmb3IgaW1wbGljaXQgZmxvdyB0byByZXR1cm4gdGhlIGFjY2Vzc1Rva2VuIHN0b3JlZCBpbiBicm93c2VyLlxuICovXG5PQXV0aENvbnRleHQucHJvdG90eXBlLmZldGNoVG9rZW4gPSBmdW5jdGlvbigpIHtcblx0aWYgKHRoaXMuY29uZmlnLmZsb3dUeXBlID09PSAnSW1wbGljaXQnKSB7XG5cdFx0dHJ5IHtcblx0XHRcdGxldCBhY2Nlc3NUb2tlbiA9IEpTT04ucGFyc2UodGhpcy5zdG9yYWdlSGFuZGxlci5nZXRTdG9yYWdlKCd0b2tlbicpKTtcblx0XHRcdHJldHVybiBhY2Nlc3NUb2tlbjtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdHRocm93IG5ldyBWZXJpZnlFcnJvcihPQVVUSF9DT05URVhUX0FQSV9FUlJPUiwgJ2ZldGNoVG9rZW4oKSBjYW4gb25seSBiZSB1c2VkIHdpdGggSW1wbGljaXQgZmxvdycpO1xuXHR9XG59O1xuXG4vKipcbiAqIEBmdW5jdGlvbiBnZXRDb25maWdcbiAqIGV4cG9zZSBjb25maWcgb2JqZWN0IGZvciBBdXRoZW50aWNhdG9yQ29udGV4dC5cbiAqL1xuT0F1dGhDb250ZXh0LnByb3RvdHlwZS5nZXRDb25maWcgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIHRoaXMuY29uZmlnO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIE9wdGlvbmFsIHN0cmluZyB0byByZWRpcmVjdCB1c2VyIGFmdGVyIGFjY2Vzc1Rva2VuIGhhcyBleHBpcmVkXG4gKiBEZWZhdWx0cyB0byBpbmRleCBwYWdlLlxuICovXG5PQXV0aENvbnRleHQucHJvdG90eXBlLmxvZ291dCA9IGFzeW5jIGZ1bmN0aW9uKHBhdGgsIHRva2VuKSB7XG5cdC8vIGNsZWFyIHN0b3JhZ2UgYW5kIHJlZGlyZWN0IHRvIGhvbWUgcGFnZVxuXHRpZiAodGhpcy5jb25maWcuZmxvd1R5cGUgPT09ICdJbXBsaWNpdCcpIHtcblx0XHRsZXQgYWNjZXNzVG9rZW4gPSB0aGlzLmZldGNoVG9rZW4oKTtcblx0XHRhd2FpdCB0aGlzLnJldm9rZVRva2VuKGFjY2Vzc1Rva2VuLCAnYWNjZXNzX3Rva2VuJyk7XG5cdFx0YXdhaXQgdGhpcy5zdG9yYWdlSGFuZGxlci5jbGVhclN0b3JhZ2UoKTtcblx0XHRhd2FpdCB3aW5kb3cubG9jYXRpb24ucmVwbGFjZShwYXRoIHx8ICcvJyk7XG5cdH0gZWxzZSB7XG5cdFx0Ly8gcGF0aCBhbmQgdG9rZW4gc3VwcGxpZWRcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiAhdXRpbHMuaXNUb2tlbih0b2tlbikpIHtcblx0XHRcdFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihUT0tFTl9FUlJPUiwgJ25vdCBhIHZhbGlkIHRva2VuLicpKTtcblx0XHR9XG5cdFx0Ly8gbm8gcGF0aCBidXQgYSAndG9rZW4nIHByb3ZpZGVkXG5cdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgIXV0aWxzLmlzVG9rZW4ocGF0aCkpIHtcblx0XHRcdFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihUT0tFTl9FUlJPUiwgJ25vdCBhIHZhbGlkIHRva2VuLicpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuXHRcdFx0dGhpcy5yZXZva2VUb2tlbih0b2tlbiwgJ2FjY2Vzc190b2tlbicpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnJldm9rZVRva2VuKHBhdGgsICdhY2Nlc3NfdG9rZW4nKTtcblx0XHR9XG5cdH1cbn07XG5cbi8qKlxuICogQGZ1bmN0aW9uIHJldm9rZVRva2VuIHVzZWQgdG8gcmV2b2tlIHZhbGlkIHRva2Vucy5cbiAqIEBwYXJhbSB7b2JqZWN0fSB0b2tlbiB0aGUgVG9rZW4gb2JqZWN0IGNvbnRhaW5pbmcgYWNjZXNzX3Rva2VuLCByZWZyZXNoX3Rva2VuIGV0Yy4uLlxuICogQHBhcmFtIHtzdHJpbmd9IHRva2VuVHlwZSB0aGUgdG9rZW4gdHlwZSB0byBiZSByZXZva2VkIFwiYWNjZXNzX3Rva2VuXCIgb3IgXCJyZWZyZXNoX3Rva2VuXCIuXG4gKi9cbk9BdXRoQ29udGV4dC5wcm90b3R5cGUucmV2b2tlVG9rZW4gPSBmdW5jdGlvbih0b2tlbiwgdG9rZW5UeXBlKSB7XG5cdGxldCBwYXRoID0gYCR7dGhpcy5jb25maWcudGVuYW50VXJsfS92MS4wL2VuZHBvaW50L2RlZmF1bHQvcmV2b2tlYDtcblx0bGV0IGV4cGlyZVRva2VuO1xuXHRsZXQgZW5jb2RlZERhdGE7XG5cdGxldCBvcHRpb25zO1xuXG5cdGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikge1xuXHRcdHRocm93IG5ldyBWZXJpZnlFcnJvcihPQVVUSF9DT05URVhUX0FQSV9FUlJPUiwgJ3Jldm9rZVRva2VuKHRva2VuLCB0b2tlblR5cGUpLCAyIHBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyB3ZXJlIGdpdmVuJyk7XG5cdH1cblxuXHRpZiAoIXRva2VuKSB7XG5cdFx0dGhyb3cgbmV3IFZlcmlmeUVycm9yKE9BVVRIX0NPTlRFWFRfQVBJX0VSUk9SLCAndG9rZW4gY2Fubm90IGJlIG51bGwnKTtcblx0fVxuXG5cdGlmICghKHRva2VuVHlwZSA9PT0gJ2FjY2Vzc190b2tlbicgfHwgdG9rZW5UeXBlID09PSAncmVmcmVzaF90b2tlbicpKSB7XG5cdFx0dGhyb3cgbmV3IFZlcmlmeUVycm9yKE9BVVRIX0NPTlRFWFRfQVBJX0VSUk9SLCBgUGFyYW1ldGVyOiAke3Rva2VuVHlwZX0gaXMgaW52YWxpZC5cXG4gU3VwcG9ydGVkIHZhbHVlcyBhcmUgXCJhY2Nlc3NfdG9rZW5cIiBvciBcInJlZnJlc2hfdG9rZW5gKTtcblx0fVxuXG5cdGV4cGlyZVRva2VuID0gdG9rZW5UeXBlID09PSAnYWNjZXNzX3Rva2VuJyA/IHRva2VuLmFjY2Vzc190b2tlbiA6IHRva2VuLnJlZnJlc2hfdG9rZW47XG5cblx0bGV0IGRhdGEgPSB7XG5cdFx0Y2xpZW50X2lkOiB0aGlzLmNvbmZpZy5jbGllbnRJZCxcblx0XHRjbGllbnRfc2VjcmV0OiB0aGlzLmNvbmZpZy5jbGllbnRTZWNyZXQsXG5cdFx0dG9rZW46IGV4cGlyZVRva2VuXG5cdH07XG5cblx0ZW5jb2RlZERhdGEgPSBxcy5zdHJpbmdpZnkoZGF0YSk7XG5cblx0b3B0aW9ucyA9IHtcblx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG5cdFx0dXJsOiBwYXRoLFxuXHRcdGRhdGE6IGVuY29kZWREYXRhXG5cdH07XG5cblx0Ly8gdG9rZW4gaXMgbm90IHJlcXVpcmVkLCBidXQgaGFuZGxlUmVzcG9uc2Ugd2lsbCB0aHJvdyBlcnJvciB3aXRob3V0IGl0XG5cdHJldHVybiB0aGlzLmhhbmRsZVJlc3BvbnNlKG9wdGlvbnMsIHRva2VuKTtcbn07XG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBoYXNoU3RyaW5nIHRoZSB1cmwgaGFzaCBmcmFnbWVudFxuICogcmV0dXJuIHVybCBoYXNoIGZyYWdtZW50IGFzIGFuIG9iamVjdFxuICovXG5PQXV0aENvbnRleHQucHJvdG90eXBlLl9wYXJzZVVybEhhc2ggPSBmdW5jdGlvbihoYXNoU3RyaW5nKSB7XG5cdGxldCBwYXJzZWRIYXNoID0gcXMucGFyc2UoaGFzaFN0cmluZyk7XG5cdHJldHVybiBwYXJzZWRIYXNoO1xufTtcblxuLyoqXG4gKiBAZnVuY3Rpb24gc2V0U2Vzc2lvbiBVc2VkIGZvciBJbXBsaWNpdCBmbG93LiBDcmVhdGVzIGEgc2Vzc2lvbiBmb3IgdGhlIFNESyB0byBtYW5hZ2UgdGhlIGFjY2VzcyB0b2tlblxuICogdmFsaWRpdHkgZm9yIHRoZSBnaXZlbiB1c2VyLiBDbGVhcnMgYnJvd3NlciBzdG9yYWdlIG9uIGFjY2VzcyB0b2tlbiBleHBpcnkuXG4gKi9cbk9BdXRoQ29udGV4dC5wcm90b3R5cGUuX3NldFNlc3Npb24gPSBmdW5jdGlvbigpIHtcblx0aWYgKHV0aWxzLmlzTm9kZSgpKSB7XG5cdFx0dGhyb3cgbmV3IFZlcmlmeUVycm9yKE9BVVRIX0NPTlRFWFRfQVBJX0VSUk9SLCAnX3NldFNlc3Npb24oKSBpcyBub3Qgc3VwcG9ydGVkIGluIE5vZGUnKTtcblx0fVxuXHRjb25zdCBleHBpcmVzQXQgPSBKU09OLnBhcnNlKHRoaXMuc3RvcmFnZUhhbmRsZXIuZ2V0U3RvcmFnZSgndG9rZW4nKSkuZXhwaXJlc19pbjtcblx0Y29uc3QgY2xvY2tTa2V3ID0gQXBwQ29uZmlnLkRFRkFVTFRfQ0xPQ0tfU0tFVztcblx0Y29uc3QgZGVsYXkgPSBleHBpcmVzQXQgLSAoRGF0ZS5ub3coKSAtIGNsb2NrU2tldyk7XG5cblx0aWYgKGRlbGF5ID4gMCkge1xuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0dGhpcy5zZXNzaW9uID0gZmFsc2U7XG5cdFx0XHR0aGlzLnN0b3JhZ2VIYW5kbGVyLmNsZWFyU3RvcmFnZSgpO1xuXHRcdH0sIGRlbGF5KTtcblx0fVxufTtcblxuLyoqXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBhcmFtc1xuICogQGZ1bmN0aW9uIGdldFRva2VuIHRvIG1ha2UgYXBpIHJlcXVlc3QgdG8gQ2xvdWQgSWRlbnRpdHkgQXV0aG9yaXphdGlvbiBzZXJ2ZXJcbiAqIHRvIHJldHJpZXZlIGFjY2Vzc190b2tlbiwgcmVmcmVzaF90b2tlbiwgZ3JhbnRfaWQuLi5cbiAqL1xuT0F1dGhDb250ZXh0LnByb3RvdHlwZS5nZXRUb2tlbiA9IGZ1bmN0aW9uKHBhcmFtcykge1xuXHRpZiAodGhpcy5jb25maWcuZmxvd1R5cGUgPT09ICdJbXBsaWNpdCcpIHtcblx0XHR0aHJvdyBuZXcgVmVyaWZ5RXJyb3IoT0FVVEhfQ09OVEVYVF9BUElfRVJST1IsICdnZXRUb2tlbigpIGNhbm5vdCBiZSB1c2VkIHdpdGggSW1wbGljaXQgZmxvdycpO1xuXHR9XG5cdGlmICghcGFyYW1zKSB7XG5cdFx0Ly8gY2hhbmdlIG1lc3NhZ2Vcblx0XHR0aHJvdyBuZXcgVmVyaWZ5RXJyb3IoT0FVVEhfQ09OVEVYVF9BUElfRVJST1IsICdnZXRUb2tlbihwYXJhbXMpLCBQYXJhbXMgYXJlIHJlcXVpcmVkJyk7XG5cdH1cblxuXHRsZXQgcXVlcnk7XG5cdGxldCBfcGFyYW1zID0gcGFyYW1zO1xuXG5cdGlmICh0aGlzLmNvbmZpZy5mbG93VHlwZSA9PT0gJ2NsaWVudF9jcmVkZW50aWFscycpIHtcblx0XHRxdWVyeSA9IF9wYXJhbXM7XG5cdH0gZWxzZSB7XG5cdFx0cXVlcnkgPSBwYXJhbXMuc3Vic3RyaW5nKHBhcmFtcy5pbmRleE9mKCc/JykpO1xuXHR9XG5cblxuXHRsZXQgZGF0YSA9IHR5cGVvZiBxdWVyeSA9PT0gJ29iamVjdCcgPyBxdWVyeSA6IHFzLnBhcnNlKHF1ZXJ5KTtcblx0bGV0IHBhdGggPSBgJHt0aGlzLmNvbmZpZy50ZW5hbnRVcmx9L3YxLjAvZW5kcG9pbnQvZGVmYXVsdC90b2tlbmA7XG5cblx0aWYgKHRoaXMuY29uZmlnLmZsb3dUeXBlID09PSAnY2xpZW50X2NyZWRlbnRpYWxzJykge1xuXHRcdGRhdGEuZ3JhbnRfdHlwZSA9IHRoaXMuY29uZmlnLmZsb3dUeXBlO1xuXHR9IGVsc2Uge1xuXHRcdGRhdGEucmVkaXJlY3RfdXJpID0gdGhpcy5jb25maWcucmVkaXJlY3RVcmk7XG5cdFx0ZGF0YS5ncmFudF90eXBlID0gJ2F1dGhvcml6YXRpb25fY29kZSc7XG5cdH1cblxuXHRkYXRhLmNsaWVudF9pZCA9IHRoaXMuY29uZmlnLmNsaWVudElkO1xuXHRkYXRhLmNsaWVudF9zZWNyZXQgPSB0aGlzLmNvbmZpZy5jbGllbnRTZWNyZXQ7XG5cdGRhdGEuc2NvcGUgPSB0aGlzLmNvbmZpZy5zY29wZTtcblxuXHRsZXQgZW5jb2RlZERhdGEgPSBxcy5zdHJpbmdpZnkoZGF0YSk7XG5cblx0bGV0IG9wdGlvbnMgPSB7XG5cdFx0bWV0aG9kOiAnUE9TVCcsXG5cdFx0dXJsOiBwYXRoLFxuXHRcdGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcblx0XHRkYXRhOiBlbmNvZGVkRGF0YVxuXHR9O1xuXG5cdHJldHVybiBhcGlSZXF1ZXN0KG9wdGlvbnMpO1xufTtcblxuLyoqXG4gKiBAZnVuY3Rpb24gcmVmcmVzaFRva2VuXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVmcmVzaFRva2VuIHJlcXVpcmVkIHJlZnJlc2hfdG9rZW4gc3RyaW5nLlxuICogUmVmcmVzaCBhY2Nlc3MgdG9rZW4gd2hlbiB0b2tlbiBoYXMgZXhwaXJlZC5cbiAqIFVzZWQgZm9yIEFaTiBmbG93IG9ubHkuXG4gKi9cbk9BdXRoQ29udGV4dC5wcm90b3R5cGUucmVmcmVzaFRva2VuID0gZnVuY3Rpb24odG9rZW4pIHtcblx0aWYgKHRoaXMuY29uZmlnLmZsb3dUeXBlID09PSAnSW1wbGljaXQnKSB7XG5cdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihPQVVUSF9DT05URVhUX0FQSV9FUlJPUiwgJ0ltcGxpY2l0IGZsb3cgZG9lcyBub3Qgc3VwcG9ydCByZWZyZXNoIHRva2VuJykpO1xuXHR9XG5cblx0aWYgKCF0b2tlbi5oYXNPd25Qcm9wZXJ0eSgncmVmcmVzaF90b2tlbicpKSB7XG5cdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihPQVVUSF9DT05URVhUX0FQSV9FUlJPUiwgJ3JlZnJlc2hfdG9rZW4gaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXInKSk7XG5cdH1cblxuXHRsZXQgcGF0aCA9IGAke3RoaXMuY29uZmlnLnRlbmFudFVybH0vdjEuMC9lbmRwb2ludC9kZWZhdWx0L3Rva2VuYDtcblx0bGV0IGRhdGEgPSB7XG5cdFx0cmVmcmVzaF90b2tlbjogdG9rZW4ucmVmcmVzaF90b2tlbixcblx0XHRjbGllbnRfaWQ6IHRoaXMuY29uZmlnLmNsaWVudElkLFxuXHRcdGNsaWVudF9zZWNyZXQ6IHRoaXMuY29uZmlnLmNsaWVudFNlY3JldCxcblx0XHRncmFudF90eXBlOiAncmVmcmVzaF90b2tlbicsXG5cdFx0c2NvcGU6IHRoaXMuY29uZmlnLnNjb3BlXG5cdH07XG5cblx0bGV0IGVuY29kZWREYXRhID0gcXMuc3RyaW5naWZ5KGRhdGEpO1xuXG5cdGxldCBvcHRpb25zID0ge1xuXHRcdG1ldGhvZDogJ1BPU1QnLFxuXHRcdHVybDogcGF0aCxcblx0XHRjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG5cdFx0ZGF0YTogZW5jb2RlZERhdGFcblx0fTtcblxuXHRyZXR1cm4gYXBpUmVxdWVzdChvcHRpb25zKTtcbn07XG5cbk9BdXRoQ29udGV4dC5wcm90b3R5cGUuX2F1dGhvcml6ZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblx0cmV0dXJuIHRoaXMuX2J1aWxkVXJsKG9wdGlvbnMpO1xufTtcblxuLyoqXG4gKiBAZnVuY3Rpb24gbG9naW5cbiAqIHVzZWQgZm9yIGltcGxpY2l0IGdyYW50IHRvIHJldHJpZXZlIHVybFxuICogYW5kIGFkZGl0aW9uYWwgcGFyYW1zIHRvIHNlbmQgdXNlci1hZ2VudCB0byBDbG91ZCBJZGVudGl0eSBsb2dpblxuICogc2NyZWVuIHRvIGF1dGhlbnRpY2F0ZSB3aXRoIHRoZSBhdXRob3JpemF0aW9uIHNlcnZlci5cbiAqL1xuT0F1dGhDb250ZXh0LnByb3RvdHlwZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuXHRsZXQgdXJsID0gdGhpcy5fYXV0aG9yaXplKHRoaXMuY29uZmlnKTtcblx0cmV0dXJuIHVybDtcbn07XG5cblxuLyoqXG4gKiBidWlsZFVybCBtZXRob2RcbiAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIGNvbmZpZ3VyYXRpb24gb2JqZWN0IHVzZWQgdG8gY3JlYXRlIGEgdXJsIHRvIHRoZSBhdXRob3JpemUgZW5kcG9pbnRcbiAqIGZvciBTU08gaW1wbGljaXQgZmxvd1xuICovXG5PQXV0aENvbnRleHQucHJvdG90eXBlLl9idWlsZFVybCA9IGZ1bmN0aW9uKG9wdHMpIHtcblx0cmV0dXJuIChcblx0XHRvcHRzLnRlbmFudFVybCArXG5cdFx0Jy9vaWRjL2VuZHBvaW50L2RlZmF1bHQvYXV0aG9yaXplPycgK1xuXHRcdHFzLnN0cmluZ2lmeSh7XG5cdFx0XHRjbGllbnRfaWQ6IG9wdHMuY2xpZW50SWQsXG5cdFx0XHRyZWRpcmVjdF91cmk6IG9wdHMucmVkaXJlY3RVcmksXG5cdFx0XHRzY29wZTogb3B0cy5zY29wZSxcblx0XHRcdHJlc3BvbnNlX3R5cGU6IG9wdHMucmVzcG9uc2VUeXBlLFxuXHRcdFx0c3RhdGU6IHV0aWxzLnJhbmRvbVN0cmluZygxNiksXG5cdFx0XHRub25jZTogdXRpbHMucmFuZG9tU3RyaW5nKDE2KVxuXHRcdH0pXG5cdCk7XG59O1xuXG4vKipcbi8qKiBBdXRob3JpemF0aW9uIGNvZGUgZmxvdyAoQVpOKVxuICogQGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZSBjb25zdHJ1Y3QgdXJsIHRvIGVuYWJsZSBhdXRoZW50aWNhdGlvbiBmb3IgdXNlci5cbiAqL1xuT0F1dGhDb250ZXh0LnByb3RvdHlwZS5hdXRoZW50aWNhdGUgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIG5ldyBQcm9taXNlKFxuXHRcdGZ1bmN0aW9uKHJlc29sdmUpIHtcblx0XHRcdHJlc29sdmUodGhpcy5fYXV0aG9yaXplKHRoaXMuY29uZmlnKSk7XG5cdFx0fS5iaW5kKHRoaXMpXG5cdCk7XG59O1xuXG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBoYXNoU3RyaW5nIHRoZSB1cmwgaGFzaCBmcmFnbWVudFxuICogcmV0dXJuIHVybCBoYXNoIGZyYWdtZW50IGFzIGFuIG9iamVjdFxuICovXG5PQXV0aENvbnRleHQucHJvdG90eXBlLl9wYXJzZUhhc2ggPSBmdW5jdGlvbihoYXNoU3RyaW5nKSB7XG5cdGxldCBwYXJzZWRIYXNoID0gcXMucGFyc2UoaGFzaFN0cmluZyk7XG5cdHJldHVybiBwYXJzZWRIYXNoO1xufTtcblxuLyoqXG4gKiBAZnVuY3Rpb24gaGFuZGxlUmVzcG9uc2UgbWV0aG9kIGhhbmRsZXMgdGhlIGFwaSByZXF1ZXN0IHRvIENsb3VkIElkZW50aXR5XG4gKiBAcGFyYW0ge29iamVjdH0gb3B0aW9ucyBPYmplY3QgY29udGFpbmluZyB0aGUgZW5kcG9pbnQgcGFyYW1zLiBbbWV0aG9kLCB1cmwgLi4uZXRjXVxuICogQHBhcmFtIHtvYmplY3R9IHRva2VuIHRoZSB0b2tlbiBvYmplY3QgY29udGFpbmluZyBhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW4gZXRjLlxuICovXG5PQXV0aENvbnRleHQucHJvdG90eXBlLmhhbmRsZVJlc3BvbnNlID0gYXN5bmMgZnVuY3Rpb24ob3B0aW9ucywgdG9rZW5PYmopIHtcblx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7XG5cdFx0dGhyb3cgbmV3IFZlcmlmeUVycm9yKE9BVVRIX0NPTlRFWFRfQVBJX0VSUk9SLCAnaGFuZGxlUmVzcG9uc2Uob3B0aW9ucywgdG9rZW4pLCAyIHBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyB3ZXJlIGdpdmVuJyk7XG5cdH1cblx0aWYgKCF1dGlscy5pc1Rva2VuKHRva2VuT2JqKSkge1xuXHRcdHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVmVyaWZ5RXJyb3IoVE9LRU5fRVJST1IsICdub3QgYSB2YWxpZCB0b2tlbicpKTtcblx0fVxuXG5cdGxldCB0b2tlbiA9IHRva2VuT2JqO1xuXHQvL0RlZmluZSBlbXB0eSBwYXlsb2FkIG9iamVjdFxuXHRsZXQgcGF5bG9hZCA9IHtcblx0XHRyZXNwb25zZTogbnVsbCxcblx0XHR0b2tlbjogbnVsbFxuXHR9O1xuXG5cdHRyeSB7XG5cdFx0bGV0IHJlc3BvbnNlID0gYXdhaXQgYXBpUmVxdWVzdChvcHRpb25zLCB0b2tlbi5hY2Nlc3NfdG9rZW4pO1xuXHRcdHBheWxvYWQucmVzcG9uc2UgPSByZXNwb25zZTtcblx0XHRpZiAodGhpcy5jb25maWcuZmxvd1R5cGUgPT09ICdJbXBsaWNpdCcpIHtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzcG9uc2UpO1xuXHRcdH1cblx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHBheWxvYWQpO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChlcnJvci5zdGF0dXMgPT09IDQwMSAmJiB1dGlscy5pc05vZGUoKSkge1xuXHRcdFx0Ly8gdmFsaWRhdGUgJ3Rva2VuJyBoYXMgcmVmcmVzaF90b2tlblxuXHRcdFx0aWYgKCF0b2tlbi5yZWZyZXNoX3Rva2VuKSB7XG5cdFx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVmVyaWZ5RXJyb3IoT0FVVEhfQ09OVEVYVF9BUElfRVJST1IsICdhY2Nlc3NfdG9rZW4gZXhwaXJlZCBhbmQgcmVmcmVzaF90b2tlbiBub3QgZm91bmQnKSk7XG5cdFx0XHR9XG5cdFx0XHRsZXQgbmV3VG9rZW4gPSBhd2FpdCB0aGlzLnJlZnJlc2hUb2tlbih0b2tlbik7XG5cdFx0XHRsZXQgb3JpZ2luYWxSZXF1ZXN0ID0gYXdhaXQgYXBpUmVxdWVzdChvcHRpb25zLCBuZXdUb2tlbi5hY2Nlc3NfdG9rZW4pO1xuXHRcdFx0cGF5bG9hZCA9IHtcblx0XHRcdFx0cmVzcG9uc2U6IG9yaWdpbmFsUmVxdWVzdCxcblx0XHRcdFx0dG9rZW46IG5ld1Rva2VuXG5cdFx0XHR9O1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZShwYXlsb2FkKTtcblx0XHR9XG5cdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcblx0fVxufTtcblxuLyoqXG4gKiBAZnVuY3Rpb24gaGFuZGxlQ2FsbGJhY2sgcmVxdWlyZWQgZm9yIGltcGxpY2l0IGZsb3cgdG8gaGFuZGxlIHRoZSBhdXRoZW50aWNhdGlvbiAvIGF1dGhvcml6YXRpb24gdHJhbnNhY3Rpb24gZnJvbSBDbG91ZCBJZGVudGl0eVxuICogYW5kIHRvIHN0b3JlIHRoZSBhY2Nlc3NfdG9rZW4gYW5kIGV4cGlyZXNfaW4gdmFsdWVzIHRvIGJyb3dzZXIgc3RvcmFnZS5cbiAqL1xuT0F1dGhDb250ZXh0LnByb3RvdHlwZS5oYW5kbGVDYWxsYmFjayA9IGZ1bmN0aW9uKCkge1xuXHRpZiAodXRpbHMuaXNOb2RlKCkpIHtcblx0XHR0aHJvdyBuZXcgVmVyaWZ5RXJyb3IoT0FVVEhfQ09OVEVYVF9BUElfRVJST1IsICdoYW5kbGVDYWxsYmFjaygpIGlzIG9ubHkgZm9yIEltcGxpY2l0IGZsb3cnKTtcblx0fVxuXHRsZXQgdXJsT2JqO1xuXHRsZXQgZXJyb3JDaGVjayA9IFJlZ0V4cCgnI2Vycm9yJyk7XG5cdGxldCBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XG5cblx0dXJsT2JqID0gdHlwZW9mIGhhc2ggPT09ICdvYmplY3QnID8gaGFzaCA6IHRoaXMuX3BhcnNlVXJsSGFzaChoYXNoKTtcblxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVqZWN0KSB7XG5cdFx0aWYgKGVycm9yQ2hlY2sudGVzdChoYXNoKSkge1xuXHRcdFx0cmVqZWN0KHVybE9iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuc3RvcmFnZUhhbmRsZXIuc2V0U3RvcmFnZSh1cmxPYmopO1xuXHRcdFx0dGhpcy5fc2V0U2Vzc2lvbigpO1xuXHRcdFx0Ly8gcmVtb3ZlIHVybFxuXHRcdFx0d2luZG93LmxvY2F0aW9uLmhhc2ggPSAnJztcblx0XHR9XG5cdH0uYmluZCh0aGlzKSk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBPQXV0aENvbnRleHQ7XG4iXX0=