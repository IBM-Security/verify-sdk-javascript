"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _config=require("./config"),_Errors=require("./errors/Errors"),_utils=_interopRequireDefault(require("./helpers/utils"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var AUTHENTICATOR_CONTEXT_ERROR=_config.AppConfig.AUTHENTICATOR_CONTEXT_ERROR,DEFAULT_POLLING_DELAY=_config.AppConfig.DEFAULT_POLLING_DELAY,DEFAULT_POLLING_ATTEMPTS=_config.AppConfig.DEFAULT_POLLING_ATTEMPTS,FLOW_TYPE={implicitFlow:"implicit",authorizationCodeFlow:"authorization",deviceFlow:"device",ROPC:"ropc"},AuthenticatorContext=/*#__PURE__*/function(){function a(b){if(_classCallCheck(this,a),!b)throw new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"Oauth parameter is required");this.oauth=b,this.config=this.oauth.getConfig(),this.config.flowType===FLOW_TYPE.implicitFlow&&(this.token=this._fetchToken())}return _createClass(a,[{key:"_fetchToken",value:function _fetchToken(){return this.oauth.fetchToken()}},{key:"_isAuthenticated",value:function _isAuthenticated(a){return this.oauth.isAuthenticated(a)}},{key:"_handleResponse",value:function _handleResponse(a,b){return this.oauth.handleResponse(a,b)}/**
     * The Authenticator object provides properties and methods to view
     * device information and remove methods
     * @param {object} tokenObj containing access_token, refresh_token ...
     */},{key:"authenticators",value:function authenticators(a){var b=a||this.token;if(!b)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"token is a required parameter"));var c="".concat(this.config.tenantUrl,"/v1.0/authenticators");return this._handleResponse({method:"GET",url:c},b)}/**
     * @function initiateAuthenticator
     * Initiates a new authenticator that the client can or enter manually using a mobile device.
     * This method returns base64 encoded data representing a QR code.
     * @param {object} dataObj containing a user friendly name for the registration.
     * @param {object} tokenObj containing access_token, refresh_token ...
     */},{key:"initiateAuthenticator",value:function initiateAuthenticator(a,b){if(2>arguments.length&&this.config.flowType!==FLOW_TYPE.implicitFlow)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"initiateAuthenticator(dataObj, token), 2 parameters are required "+arguments.length+" were given"));if(!a)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"dataObj cannot be null"));var c={},d="?qrcodeInResponse=",e="".concat(this.config.tenantUrl,"/v1.0/authenticators/initiation");a.hasOwnProperty("qrcodeInResponse")&&!0===a.qrcodeInResponse&&(d="".concat(d,"true"),e="".concat(e).concat(d),c.accept="image/png");var f=b||this.token;return c={method:"POST",url:e,data:{owner:a.owner||null,clientId:this.config.registrationProfileId,accountName:a.accountName||"Default Account"}},this._handleResponse(c,f)}/**
     * @function createVerification function creates a transaction and sends a push notification to the associated authenticator.
     * @param {string} authenticatorId Creates a new verification for the registered authenticator.
     * @param {object} formData  a JSON payload that specifies the verification transaction data
     * @param {object} tokenObj containing access_token, refresh_token ...
     */},{key:"createVerification",value:function createVerification(a,b,c){if(3>arguments.length&&this.config.flowType!==FLOW_TYPE.implicitFlow)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"createVerification(authenticatorId, formData, token), 3 parameters are required "+arguments.length+" were given"));if(!b)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"formData is a required parameter"));var d=c||this.token,e="".concat(this.config.tenantUrl,"/v1.0/authenticators/").concat(a,"/verifications"),f={transactionData:{message:b.txMessage||" ",originIpAddress:b.originIpAddress||" ",originUserAgent:b.originUserAgent||" ",additionalData:b.txAdditionalData},pushNotification:{title:b.title||" ",send:b.send,message:b.pushMessage||" "},authenticationMethods:[{id:b.methodId,methodType:"signature"}],logic:"OR",expiresIn:b.expires||120};return this._handleResponse({method:"POST",url:e,data:f},d)}/**
     * @function viewVerifications Retrieve the list of verification transactions.
     * @param {string} authenticatorId The authenticator registration identifier.
     * @param {object} tokenObj containing access_token, refresh_token ...
     */},{key:"viewVerifications",value:function viewVerifications(a,b){if(2>arguments.length&&this.config.flowType!==FLOW_TYPE.implicitFlow)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"viewVerifications(authenticatorId, token), 2 parameters are required "+arguments.length+" were given"));var c=b||this.token,d="".concat(this.config.tenantUrl,"/v1.0/authenticators/").concat(a,"/verifications");return this._handleResponse({method:"GET",url:d},c)}/**
     * @function viewVerification Retrieve a specific verification transaction that is associated with an authenticator registration.
     * @param {string} authenticatorId The authenticator registration identifier.
     * @param {string} transactionId The verification transaction identifier.
     * @param {object} tokenObj containing access_token, refresh_token ...
     */},{key:"viewVerification",value:function viewVerification(a,b,c){if(3>arguments.length&&this.config.flowType!==FLOW_TYPE.implicitFlow)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"viewVerification(authenticatorId, transactionId, token), 3 parameters are required "+arguments.length+" were given"));var d=c||this.token,e="".concat(this.config.tenantUrl,"/v1.0/authenticators/").concat(a,"/verifications/").concat(b);return this._handleResponse({method:"GET",url:e},d)}/**
     * @function pollVerification recursive function that polls a given transaction id for a state change
     * @param {string} authenticatorId authenticator id
     * @param {object} transactionId transaction id
     * @param {object} tokenObj containing access_token, refresh_token ...
     * @param {object} delay delay between polls
     * @param {object} attempts how many times to poll
     */},{key:"pollVerification",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b,c,d,e,f){var g,h,i,j,k;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:g=d,h=f||DEFAULT_POLLING_ATTEMPTS,i=e||DEFAULT_POLLING_DELAY,j=!1;case 4:if(!(0<h)){a.next=22;break}return a.prev=5,a.next=8,this.viewVerification(b,c,d);case 8:if(k=a.sent,k.token&&(j=!0,g=k.token),"PENDING"===k.response.state&&"SENDING"===k.response.state){a.next=12;break}return a.abrupt("return",Promise.resolve({state:k.response.state,token:j?g:null}));case 12:return a.next=14,_utils.default.sleep(i);case 14:a.next=19;break;case 16:return a.prev=16,a.t0=a["catch"](5),a.abrupt("return",Promise.reject(a.t0));case 19:h--,a.next=4;break;case 22:return a.abrupt("return",Promise.reject(new _Errors.VerifyError("number of polling attempts exceeded")));case 23:case"end":return a.stop();}},a,this,[[5,16]])}));return function pollVerification(){return a.apply(this,arguments)}}()/**
     * @function enabled function to update attributes of a specific authenticator registration for
     * IBM Verify instances or custom mobile authenticators that are built from the IBM Verify SDK.
     * @param {string} authenticatorId Id of authenticated device
     * @param {boolean} enabled boolean to enable/disable enrolled method
     * @param {object} tokenObj containing access_token, refresh_token ...
     */},{key:"enabled",value:function enabled(a,b,c){if(3>arguments.length&&this.config.flowType!==FLOW_TYPE.implicitFlow)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"enabled(authenticatorId, enabled, token), 3 parameters are required "+arguments.length+" were given"));var d=c||this.token,e="".concat(this.config.tenantUrl,"/v1.0/authenticators/").concat(a);return this._handleResponse({method:"PATCH",url:e,data:[{path:"/enabled",value:b,op:"replace"}],contentType:"application/json-patch+json"},d)}/**
     * @function deleteAuthenticator function to delete a specific authenticator registration for IBM Verify instances or
     * custom mobile authenticators that are built from the IBM Verify SDK.
     * @param {string} authenticatorId Id of authenticated device to be deleted.
     * @param {object} tokenObj containing access_token, refresh_token ...
     */},{key:"deleteAuthenticator",value:function deleteAuthenticator(a,b){if(2>arguments.length&&this.config.flowType!==FLOW_TYPE.implicitFlow)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"deleteAuthenticator(authenticatorId, token), 2 parameters are required "+arguments.length+" were given"));var c=b||this.token,d="".concat(this.config.tenantUrl,"/v1.0/authenticators/").concat(a);return this._handleResponse({method:"DELETE",url:d,data:!1},c)}/**
     * @function methodEnabled Gets or sets the current status of the method.
     * @param {string} id The signature enrollment identifier
     * @param {boolean} enabled Enable / Disable enrolled signature method.
     * @param {object} tokenObj containing access_token, refresh_token ...
     */},{key:"methodEnabled",value:function methodEnabled(a,b,c){if(3>arguments.length&&this.config.flowType!==FLOW_TYPE.implicitFlow)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"methodEnabled(id, enabled, token), 3 parameters are required "+arguments.length+" were given"));var d=c||this.token,e="".concat(this.config.tenantUrl,"/v1.0/authnmethods/signatures/").concat(a);return this._handleResponse({method:"PATCH",url:e,data:[{path:"/enabled",value:b,op:"replace"}],contentType:"application/json-patch+json"},d)}/**
     * @function methods Gets an array of method objects containing all the enrolled methods for a given authenticator.
     * @param {string} authenticatorId unique ID of registered authenticator
     * @param {object} tokenObj containing access_token, refresh_token ...
     */},{key:"methods",value:function methods(a,b){if(2>arguments.length&&this.config.flowType!==FLOW_TYPE.implicitFlow)return Promise.reject(new _Errors.VerifyError(AUTHENTICATOR_CONTEXT_ERROR,"methods(authenticatorId, token), 2 parameters are required "+arguments.length+" were given"));var c=b||this.token,d=encodeURIComponent("attributes/authenticatorId=\"".concat(a,"\"")),e="".concat(this.config.tenantUrl,"/v1.0/authnmethods/signatures?search=").concat(d);return this._handleResponse({method:"GET",url:e},c)}}]),a}(),_default=AuthenticatorContext;exports.default=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9BdXRoZW50aWNhdG9yQ29udGV4dC5qcyJdLCJuYW1lcyI6WyJBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IiLCJBcHBDb25maWciLCJERUZBVUxUX1BPTExJTkdfREVMQVkiLCJERUZBVUxUX1BPTExJTkdfQVRURU1QVFMiLCJGTE9XX1RZUEUiLCJpbXBsaWNpdEZsb3ciLCJhdXRob3JpemF0aW9uQ29kZUZsb3ciLCJkZXZpY2VGbG93IiwiUk9QQyIsIkF1dGhlbnRpY2F0b3JDb250ZXh0Iiwib2F1dGgiLCJWZXJpZnlFcnJvciIsImNvbmZpZyIsImdldENvbmZpZyIsImZsb3dUeXBlIiwidG9rZW4iLCJfZmV0Y2hUb2tlbiIsImZldGNoVG9rZW4iLCJpc0F1dGhlbnRpY2F0ZWQiLCJvcHRpb25zIiwiaGFuZGxlUmVzcG9uc2UiLCJ0b2tlbk9iaiIsIlByb21pc2UiLCJyZWplY3QiLCJwYXRoIiwidGVuYW50VXJsIiwiX2hhbmRsZVJlc3BvbnNlIiwibWV0aG9kIiwidXJsIiwiZGF0YU9iaiIsImFyZ3VtZW50cyIsImxlbmd0aCIsInFyY29kZVBhcmFtIiwiaGFzT3duUHJvcGVydHkiLCJxcmNvZGVJblJlc3BvbnNlIiwiYWNjZXB0IiwiZGF0YSIsIm93bmVyIiwiY2xpZW50SWQiLCJyZWdpc3RyYXRpb25Qcm9maWxlSWQiLCJhY2NvdW50TmFtZSIsImF1dGhlbnRpY2F0b3JJZCIsImZvcm1EYXRhIiwidHJhbnNhY3Rpb25EYXRhIiwibWVzc2FnZSIsInR4TWVzc2FnZSIsIm9yaWdpbklwQWRkcmVzcyIsIm9yaWdpblVzZXJBZ2VudCIsImFkZGl0aW9uYWxEYXRhIiwidHhBZGRpdGlvbmFsRGF0YSIsInB1c2hOb3RpZmljYXRpb24iLCJ0aXRsZSIsInNlbmQiLCJwdXNoTWVzc2FnZSIsImF1dGhlbnRpY2F0aW9uTWV0aG9kcyIsImlkIiwibWV0aG9kSWQiLCJtZXRob2RUeXBlIiwibG9naWMiLCJleHBpcmVzSW4iLCJleHBpcmVzIiwidHJhbnNhY3Rpb25JZCIsImRlbGF5IiwiYXR0ZW1wdHMiLCJfdG9rZW5PYmoiLCJfYXR0ZW1wdHMiLCJfZGVsYXkiLCJ0b2tlblJlZnJlc2hlZCIsInZpZXdWZXJpZmljYXRpb24iLCJwYXlsb2FkIiwicmVzcG9uc2UiLCJzdGF0ZSIsInJlc29sdmUiLCJ1dGlscyIsInNsZWVwIiwiZW5hYmxlZCIsInZhbHVlIiwib3AiLCJjb250ZW50VHlwZSIsImVuY29kZWRWYWx1ZSIsImVuY29kZVVSSUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6ImtpQ0FLSUEsQ0FBQUEsMkIsQ0FHQUMsaUIsQ0FIQUQsMkIsQ0FDQUUscUIsQ0FFQUQsaUIsQ0FGQUMscUIsQ0FDQUMsd0IsQ0FDQUYsaUIsQ0FEQUUsd0IsQ0FHRUMsU0FBUyxDQUFHLENBQ2RDLFlBQVksQ0FBRSxVQURBLENBRWRDLHFCQUFxQixDQUFFLGVBRlQsQ0FHZEMsVUFBVSxDQUFFLFFBSEUsQ0FJZEMsSUFBSSxDQUFFLE1BSlEsQyxDQVdaQyxvQix5QkFFRixXQUFZQyxDQUFaLENBQW1CLENBQ2YsMkJBQUksQ0FBQ0EsQ0FBTCxDQUNJLEtBQU0sSUFBSUMsb0JBQUosQ0FBZ0JYLDJCQUFoQixDQUE2Qyw2QkFBN0MsQ0FBTixDQUVKLEtBQUtVLEtBQUwsQ0FBYUEsQ0FKRSxDQUtmLEtBQUtFLE1BQUwsQ0FBYyxLQUFLRixLQUFMLENBQVdHLFNBQVgsRUFMQyxDQU1YLEtBQUtELE1BQUwsQ0FBWUUsUUFBWixHQUF5QlYsU0FBUyxDQUFDQyxZQU54QixHQU9YLEtBQUtVLEtBQUwsQ0FBYSxLQUFLQyxXQUFMLEVBUEYsQ0FTbEIsQyxzRUFFYSxDQUNWLE1BQU8sTUFBS04sS0FBTCxDQUFXTyxVQUFYLEVBQ1YsQywwREFFZ0JGLEMsQ0FBTyxDQUNwQixNQUFPLE1BQUtMLEtBQUwsQ0FBV1EsZUFBWCxDQUEyQkgsQ0FBM0IsQ0FDVixDLHdEQUVlSSxDLENBQVNKLEMsQ0FBTyxDQUM1QixNQUFPLE1BQUtMLEtBQUwsQ0FBV1UsY0FBWCxDQUEwQkQsQ0FBMUIsQ0FBbUNK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TCxDQUFZYSxTQUFsQiwwQ0FBNEQ4QixDQUE1RCxDQU55QixDQWtCakMsTUFBTyxNQUFLN0IsZUFBTCxDQVhPLENBQ1ZDLE1BQU0sQ0FBRSxPQURFLENBRVZDLEdBQUcsQ0FBRUosQ0FGSyxDQUdWWSxJQUFJLENBQUUsQ0FBQyxDQUNIWixJQUFJLENBQUUsVUFESCxDQUVIb0QsS0FBSyxDQUFFRCxDQUZKLENBR0hFLEVBQUUsQ0FBRSxTQUhELENBQUQsQ0FISSxDQVFWQyxXQUFXLENBQUUsNkJBUkgsQ0FXUCxDQUE4Qi9ELENBQTlCLENBQ1YsQ0FFRDs7OzsrQ0FLUTBCLEMsQ0FBaUJwQixDLENBQVUsQ0FDL0IsR0FBdUIsQ0FBbkIsQ0FBQVMsU0FBUyxDQUFDQyxNQUFWLEVBQXdCLEtBQUtuQixNQUFMLENBQVlFLFFBQVosR0FBeUJWLFNBQVMsQ0FBQ0MsWUFBL0QsQ0FDSSxNQUFPaUIsQ0FBQUEsT0FBTyxDQUFDQyxNQUFSLENBQWUsR0FBSVosb0JBQUosQ0FBZ0JYLDJCQUFoQixDQUE2Qyw4REFBZ0U4QixTQUFTLENBQUNDLE1BQTFFLENBQW1GLGFBQWhJLENBQWYsQ0FBUCxDQUYyQixHQUszQmhCLENBQUFBLENBQUssQ0FBR00sQ0FBUSxFQUFJLEtBQUtOLEtBTEUsQ0FNM0JnRSxDQUFZLENBQUdDLGtCQUFrQix3Q0FBZ0N2QyxDQUFoQyxPQU5OLENBTzNCakIsQ0FBSSxXQUFNLEtBQUtaLE1BQUwsQ0FBWWEsU0FBbEIsaURBQW1Fc0QsQ0FBbkUsQ0FQdUIsQ0FhL0IsTUFBTyxNQUFLckQsZUFBTCxDQUxPLENBQ1ZDLE1BQU0sQ0FBRSxLQURFLENBRVZDLEdBQUcsQ0FBRUosQ0FGSyxDQUtQLENBQThCVCxDQUE5QixDQUNWLEMsa0JBSVVOLG9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwQ29uZmlnIH0gZnJvbSAnLi9jb25maWcnO1xuaW1wb3J0IHsgVmVyaWZ5RXJyb3IgfSBmcm9tICcuL2Vycm9ycy9FcnJvcnMnO1xuaW1wb3J0IHV0aWxzIGZyb20gJy4vaGVscGVycy91dGlscyc7XG5cbmNvbnN0IHtcbiAgICBBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IsXG4gICAgREVGQVVMVF9QT0xMSU5HX0RFTEFZLFxuICAgIERFRkFVTFRfUE9MTElOR19BVFRFTVBUU1xufSA9IEFwcENvbmZpZztcblxuY29uc3QgRkxPV19UWVBFID0ge1xuICAgIGltcGxpY2l0RmxvdzogJ2ltcGxpY2l0JyxcbiAgICBhdXRob3JpemF0aW9uQ29kZUZsb3c6ICdhdXRob3JpemF0aW9uJyxcbiAgICBkZXZpY2VGbG93OiAnZGV2aWNlJyxcbiAgICBST1BDOiAncm9wYydcbn07XG5cbi8qKlxuICogQXV0aGVudGljYXRvckNvbnRleHQgaGFuZGxlcyBhbGwgcmVxdWVzdHMgaW4gcmVnYXJkcyB0byBhdXRoZW50aWNhdG9ycywgc3VjaFxuICogYXMgdGhlIElCTSBWZXJpZnkgbW9iaWxlIGFwcGxpY2F0aW9uIFxuICovXG5jbGFzcyBBdXRoZW50aWNhdG9yQ29udGV4dCB7XG5cbiAgICBjb25zdHJ1Y3RvcihvYXV0aCkge1xuICAgICAgICBpZiAoIW9hdXRoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVmVyaWZ5RXJyb3IoQVVUSEVOVElDQVRPUl9DT05URVhUX0VSUk9SLCAnT2F1dGggcGFyYW1ldGVyIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vYXV0aCA9IG9hdXRoO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHRoaXMub2F1dGguZ2V0Q29uZmlnKCk7XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5mbG93VHlwZSA9PT0gRkxPV19UWVBFLmltcGxpY2l0Rmxvdykge1xuICAgICAgICAgICAgdGhpcy50b2tlbiA9IHRoaXMuX2ZldGNoVG9rZW4oKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9mZXRjaFRva2VuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vYXV0aC5mZXRjaFRva2VuKCk7XG4gICAgfVxuXG4gICAgX2lzQXV0aGVudGljYXRlZCh0b2tlbikge1xuICAgICAgICByZXR1cm4gdGhpcy5vYXV0aC5pc0F1dGhlbnRpY2F0ZWQodG9rZW4pO1xuICAgIH1cblxuICAgIF9oYW5kbGVSZXNwb25zZShvcHRpb25zLCB0b2tlbikge1xuICAgICAgICByZXR1cm4gdGhpcy5vYXV0aC5oYW5kbGVSZXNwb25zZShvcHRpb25zLCB0b2tlbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIEF1dGhlbnRpY2F0b3Igb2JqZWN0IHByb3ZpZGVzIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMgdG8gdmlld1xuICAgICAqIGRldmljZSBpbmZvcm1hdGlvbiBhbmQgcmVtb3ZlIG1ldGhvZHNcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gdG9rZW5PYmogY29udGFpbmluZyBhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW4gLi4uXG4gICAgICovXG4gICAgYXV0aGVudGljYXRvcnModG9rZW5PYmopIHtcbiAgICAgICAgbGV0IHRva2VuID0gdG9rZW5PYmogfHwgdGhpcy50b2tlbjtcbiAgICAgICAgaWYgKCF0b2tlbikge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IsICd0b2tlbiBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlcicpKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcGF0aCA9IGAke3RoaXMuY29uZmlnLnRlbmFudFVybH0vdjEuMC9hdXRoZW50aWNhdG9yc2A7XG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogcGF0aFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVSZXNwb25zZShvcHRpb25zLCB0b2tlbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGZ1bmN0aW9uIGluaXRpYXRlQXV0aGVudGljYXRvclxuICAgICAqIEluaXRpYXRlcyBhIG5ldyBhdXRoZW50aWNhdG9yIHRoYXQgdGhlIGNsaWVudCBjYW4gb3IgZW50ZXIgbWFudWFsbHkgdXNpbmcgYSBtb2JpbGUgZGV2aWNlLlxuICAgICAqIFRoaXMgbWV0aG9kIHJldHVybnMgYmFzZTY0IGVuY29kZWQgZGF0YSByZXByZXNlbnRpbmcgYSBRUiBjb2RlLlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhT2JqIGNvbnRhaW5pbmcgYSB1c2VyIGZyaWVuZGx5IG5hbWUgZm9yIHRoZSByZWdpc3RyYXRpb24uXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHRva2VuT2JqIGNvbnRhaW5pbmcgYWNjZXNzX3Rva2VuLCByZWZyZXNoX3Rva2VuIC4uLlxuICAgICAqL1xuICAgIGluaXRpYXRlQXV0aGVudGljYXRvcihkYXRhT2JqLCB0b2tlbk9iaikge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIgJiYgdGhpcy5jb25maWcuZmxvd1R5cGUgIT09IEZMT1dfVFlQRS5pbXBsaWNpdEZsb3cpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVmVyaWZ5RXJyb3IoQVVUSEVOVElDQVRPUl9DT05URVhUX0VSUk9SLCAnaW5pdGlhdGVBdXRoZW50aWNhdG9yKGRhdGFPYmosIHRva2VuKSwgMiBwYXJhbWV0ZXJzIGFyZSByZXF1aXJlZCAnICsgYXJndW1lbnRzLmxlbmd0aCArICcgd2VyZSBnaXZlbicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghZGF0YU9iaikge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IsICdkYXRhT2JqIGNhbm5vdCBiZSBudWxsJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG9wdGlvbnMgPSB7fTtcbiAgICAgICAgbGV0IHFyY29kZVBhcmFtID0gJz9xcmNvZGVJblJlc3BvbnNlPSc7XG4gICAgICAgIGxldCBwYXRoID0gYCR7dGhpcy5jb25maWcudGVuYW50VXJsfS92MS4wL2F1dGhlbnRpY2F0b3JzL2luaXRpYXRpb25gO1xuXG4gICAgICAgIGlmIChkYXRhT2JqLmhhc093blByb3BlcnR5KCdxcmNvZGVJblJlc3BvbnNlJykgJiYgZGF0YU9iai5xcmNvZGVJblJlc3BvbnNlID09PSB0cnVlKSB7XG4gICAgICAgICAgICBxcmNvZGVQYXJhbSA9IGAke3FyY29kZVBhcmFtfXRydWVgO1xuICAgICAgICAgICAgcGF0aCA9IGAke3BhdGh9JHtxcmNvZGVQYXJhbX1gO1xuICAgICAgICAgICAgb3B0aW9ucy5hY2NlcHQgPSAnaW1hZ2UvcG5nJztcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB0b2tlbiA9IHRva2VuT2JqIHx8IHRoaXMudG9rZW47XG4gICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogcGF0aCxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBvd25lcjogZGF0YU9iai5vd25lciB8fCBudWxsLFxuICAgICAgICAgICAgICAgIGNsaWVudElkOiB0aGlzLmNvbmZpZy5yZWdpc3RyYXRpb25Qcm9maWxlSWQsXG4gICAgICAgICAgICAgICAgYWNjb3VudE5hbWU6IGRhdGFPYmouYWNjb3VudE5hbWUgfHwgJ0RlZmF1bHQgQWNjb3VudCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZVJlc3BvbnNlKG9wdGlvbnMsIHRva2VuKTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIEBmdW5jdGlvbiBjcmVhdGVWZXJpZmljYXRpb24gZnVuY3Rpb24gY3JlYXRlcyBhIHRyYW5zYWN0aW9uIGFuZCBzZW5kcyBhIHB1c2ggbm90aWZpY2F0aW9uIHRvIHRoZSBhc3NvY2lhdGVkIGF1dGhlbnRpY2F0b3IuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGF1dGhlbnRpY2F0b3JJZCBDcmVhdGVzIGEgbmV3IHZlcmlmaWNhdGlvbiBmb3IgdGhlIHJlZ2lzdGVyZWQgYXV0aGVudGljYXRvci5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gZm9ybURhdGEgIGEgSlNPTiBwYXlsb2FkIHRoYXQgc3BlY2lmaWVzIHRoZSB2ZXJpZmljYXRpb24gdHJhbnNhY3Rpb24gZGF0YVxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSB0b2tlbk9iaiBjb250YWluaW5nIGFjY2Vzc190b2tlbiwgcmVmcmVzaF90b2tlbiAuLi5cbiAgICAgKi9cbiAgICBjcmVhdGVWZXJpZmljYXRpb24oYXV0aGVudGljYXRvcklkLCBmb3JtRGF0YSwgdG9rZW5PYmopIHtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzICYmIHRoaXMuY29uZmlnLmZsb3dUeXBlICE9PSBGTE9XX1RZUEUuaW1wbGljaXRGbG93KSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUiwgJ2NyZWF0ZVZlcmlmaWNhdGlvbihhdXRoZW50aWNhdG9ySWQsIGZvcm1EYXRhLCB0b2tlbiksIDMgcGFyYW1ldGVycyBhcmUgcmVxdWlyZWQgJyArIGFyZ3VtZW50cy5sZW5ndGggKyAnIHdlcmUgZ2l2ZW4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWZvcm1EYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUiwgJ2Zvcm1EYXRhIGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRva2VuID0gdG9rZW5PYmogfHwgdGhpcy50b2tlbjtcbiAgICAgICAgbGV0IHBhdGggPSBgJHt0aGlzLmNvbmZpZy50ZW5hbnRVcmx9L3YxLjAvYXV0aGVudGljYXRvcnMvJHthdXRoZW50aWNhdG9ySWR9L3ZlcmlmaWNhdGlvbnNgO1xuXG4gICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRhOiB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZTogZm9ybURhdGEudHhNZXNzYWdlIHx8ICcgJyxcbiAgICAgICAgICAgICAgICBvcmlnaW5JcEFkZHJlc3M6IGZvcm1EYXRhLm9yaWdpbklwQWRkcmVzcyB8fCAnICcsXG4gICAgICAgICAgICAgICAgb3JpZ2luVXNlckFnZW50OiBmb3JtRGF0YS5vcmlnaW5Vc2VyQWdlbnQgfHwgJyAnLFxuICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxEYXRhOiBmb3JtRGF0YS50eEFkZGl0aW9uYWxEYXRhXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbjoge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBmb3JtRGF0YS50aXRsZSB8fCAnICcsXG4gICAgICAgICAgICAgICAgc2VuZDogZm9ybURhdGEuc2VuZCxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBmb3JtRGF0YS5wdXNoTWVzc2FnZSB8fCAnICdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhdXRoZW50aWNhdGlvbk1ldGhvZHM6IFt7XG4gICAgICAgICAgICAgICAgaWQ6IGZvcm1EYXRhLm1ldGhvZElkLFxuICAgICAgICAgICAgICAgIG1ldGhvZFR5cGU6ICdzaWduYXR1cmUnXG4gICAgICAgICAgICB9XSxcbiAgICAgICAgICAgIGxvZ2ljOiAnT1InLFxuICAgICAgICAgICAgZXhwaXJlc0luOiBmb3JtRGF0YS5leHBpcmVzIHx8IDEyMFxuICAgICAgICB9O1xuXG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6IHBhdGgsXG4gICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZVJlc3BvbnNlKG9wdGlvbnMsIHRva2VuKTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIEBmdW5jdGlvbiB2aWV3VmVyaWZpY2F0aW9ucyBSZXRyaWV2ZSB0aGUgbGlzdCBvZiB2ZXJpZmljYXRpb24gdHJhbnNhY3Rpb25zLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhdXRoZW50aWNhdG9ySWQgVGhlIGF1dGhlbnRpY2F0b3IgcmVnaXN0cmF0aW9uIGlkZW50aWZpZXIuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHRva2VuT2JqIGNvbnRhaW5pbmcgYWNjZXNzX3Rva2VuLCByZWZyZXNoX3Rva2VuIC4uLlxuICAgICAqL1xuICAgIHZpZXdWZXJpZmljYXRpb25zKGF1dGhlbnRpY2F0b3JJZCwgdG9rZW5PYmopIHtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyICYmIHRoaXMuY29uZmlnLmZsb3dUeXBlICE9PSBGTE9XX1RZUEUuaW1wbGljaXRGbG93KSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUiwgJ3ZpZXdWZXJpZmljYXRpb25zKGF1dGhlbnRpY2F0b3JJZCwgdG9rZW4pLCAyIHBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyB3ZXJlIGdpdmVuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRva2VuID0gdG9rZW5PYmogfHwgdGhpcy50b2tlbjtcbiAgICAgICAgbGV0IHBhdGggPSBgJHt0aGlzLmNvbmZpZy50ZW5hbnRVcmx9L3YxLjAvYXV0aGVudGljYXRvcnMvJHthdXRoZW50aWNhdG9ySWR9L3ZlcmlmaWNhdGlvbnNgO1xuICAgICAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6IHBhdGhcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZVJlc3BvbnNlKG9wdGlvbnMsIHRva2VuKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZnVuY3Rpb24gdmlld1ZlcmlmaWNhdGlvbiBSZXRyaWV2ZSBhIHNwZWNpZmljIHZlcmlmaWNhdGlvbiB0cmFuc2FjdGlvbiB0aGF0IGlzIGFzc29jaWF0ZWQgd2l0aCBhbiBhdXRoZW50aWNhdG9yIHJlZ2lzdHJhdGlvbi5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gYXV0aGVudGljYXRvcklkIFRoZSBhdXRoZW50aWNhdG9yIHJlZ2lzdHJhdGlvbiBpZGVudGlmaWVyLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2FjdGlvbklkIFRoZSB2ZXJpZmljYXRpb24gdHJhbnNhY3Rpb24gaWRlbnRpZmllci5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gdG9rZW5PYmogY29udGFpbmluZyBhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW4gLi4uXG4gICAgICovXG4gICAgdmlld1ZlcmlmaWNhdGlvbihhdXRoZW50aWNhdG9ySWQsIHRyYW5zYWN0aW9uSWQsIHRva2VuT2JqKSB7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMyAmJiB0aGlzLmNvbmZpZy5mbG93VHlwZSAhPT0gRkxPV19UWVBFLmltcGxpY2l0Rmxvdykge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IsICd2aWV3VmVyaWZpY2F0aW9uKGF1dGhlbnRpY2F0b3JJZCwgdHJhbnNhY3Rpb25JZCwgdG9rZW4pLCAzIHBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyB3ZXJlIGdpdmVuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRva2VuID0gdG9rZW5PYmogfHwgdGhpcy50b2tlbjtcbiAgICAgICAgbGV0IHBhdGggPSBgJHt0aGlzLmNvbmZpZy50ZW5hbnRVcmx9L3YxLjAvYXV0aGVudGljYXRvcnMvJHthdXRoZW50aWNhdG9ySWR9L3ZlcmlmaWNhdGlvbnMvJHt0cmFuc2FjdGlvbklkfWA7XG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogcGF0aFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlUmVzcG9uc2Uob3B0aW9ucywgdG9rZW4pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBmdW5jdGlvbiBwb2xsVmVyaWZpY2F0aW9uIHJlY3Vyc2l2ZSBmdW5jdGlvbiB0aGF0IHBvbGxzIGEgZ2l2ZW4gdHJhbnNhY3Rpb24gaWQgZm9yIGEgc3RhdGUgY2hhbmdlXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGF1dGhlbnRpY2F0b3JJZCBhdXRoZW50aWNhdG9yIGlkXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHRyYW5zYWN0aW9uSWQgdHJhbnNhY3Rpb24gaWRcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gdG9rZW5PYmogY29udGFpbmluZyBhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW4gLi4uXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGRlbGF5IGRlbGF5IGJldHdlZW4gcG9sbHNcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYXR0ZW1wdHMgaG93IG1hbnkgdGltZXMgdG8gcG9sbFxuICAgICAqL1xuICAgIGFzeW5jIHBvbGxWZXJpZmljYXRpb24oYXV0aGVudGljYXRvcklkLCB0cmFuc2FjdGlvbklkLCB0b2tlbk9iaiwgZGVsYXksIGF0dGVtcHRzKSB7XG4gICAgICAgIGxldCBfdG9rZW5PYmogPSB0b2tlbk9iajtcbiAgICAgICAgbGV0IF9hdHRlbXB0cyA9IGF0dGVtcHRzIHx8IERFRkFVTFRfUE9MTElOR19BVFRFTVBUUztcbiAgICAgICAgbGV0IF9kZWxheSA9IGRlbGF5IHx8IERFRkFVTFRfUE9MTElOR19ERUxBWTtcblxuICAgICAgICBsZXQgdG9rZW5SZWZyZXNoZWQgPSBmYWxzZTtcblxuICAgICAgICB3aGlsZSAoX2F0dGVtcHRzID4gMCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBsZXQgcGF5bG9hZCA9IGF3YWl0IHRoaXMudmlld1ZlcmlmaWNhdGlvbihhdXRoZW50aWNhdG9ySWQsIHRyYW5zYWN0aW9uSWQsIHRva2VuT2JqKTtcblxuICAgICAgICAgICAgICAgIC8vIHRva2VuIHdhcyByZWZyZXNoZWRcbiAgICAgICAgICAgICAgICBpZiAocGF5bG9hZC50b2tlbikge1xuICAgICAgICAgICAgICAgICAgICB0b2tlblJlZnJlc2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIF90b2tlbk9iaiA9IHBheWxvYWQudG9rZW47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gJ1BFTkRJTkcnIGlzIGRlZmF1bHQgdmFsdWVcbiAgICAgICAgICAgICAgICBpZiAocGF5bG9hZC5yZXNwb25zZS5zdGF0ZSAhPT0gJ1BFTkRJTkcnIHx8IHBheWxvYWQucmVzcG9uc2Uuc3RhdGUgIT09ICdTRU5ESU5HJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgc3RhdGU6IHBheWxvYWQucmVzcG9uc2Uuc3RhdGUsIHRva2VuOiB0b2tlblJlZnJlc2hlZCA/IF90b2tlbk9iaiA6IG51bGwgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYXdhaXQgdXRpbHMuc2xlZXAoX2RlbGF5KTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX2F0dGVtcHRzLS07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKCdudW1iZXIgb2YgcG9sbGluZyBhdHRlbXB0cyBleGNlZWRlZCcpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZnVuY3Rpb24gZW5hYmxlZCBmdW5jdGlvbiB0byB1cGRhdGUgYXR0cmlidXRlcyBvZiBhIHNwZWNpZmljIGF1dGhlbnRpY2F0b3IgcmVnaXN0cmF0aW9uIGZvclxuICAgICAqIElCTSBWZXJpZnkgaW5zdGFuY2VzIG9yIGN1c3RvbSBtb2JpbGUgYXV0aGVudGljYXRvcnMgdGhhdCBhcmUgYnVpbHQgZnJvbSB0aGUgSUJNIFZlcmlmeSBTREsuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGF1dGhlbnRpY2F0b3JJZCBJZCBvZiBhdXRoZW50aWNhdGVkIGRldmljZVxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gZW5hYmxlZCBib29sZWFuIHRvIGVuYWJsZS9kaXNhYmxlIGVucm9sbGVkIG1ldGhvZFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSB0b2tlbk9iaiBjb250YWluaW5nIGFjY2Vzc190b2tlbiwgcmVmcmVzaF90b2tlbiAuLi5cbiAgICAgKi9cbiAgICBlbmFibGVkKGF1dGhlbnRpY2F0b3JJZCwgZW5hYmxlZCwgdG9rZW5PYmopIHtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzICYmIHRoaXMuY29uZmlnLmZsb3dUeXBlICE9PSBGTE9XX1RZUEUuaW1wbGljaXRGbG93KSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUiwgJ2VuYWJsZWQoYXV0aGVudGljYXRvcklkLCBlbmFibGVkLCB0b2tlbiksIDMgcGFyYW1ldGVycyBhcmUgcmVxdWlyZWQgJyArIGFyZ3VtZW50cy5sZW5ndGggKyAnIHdlcmUgZ2l2ZW4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdG9rZW4gPSB0b2tlbk9iaiB8fCB0aGlzLnRva2VuO1xuICAgICAgICBsZXQgcGF0aCA9IGAke3RoaXMuY29uZmlnLnRlbmFudFVybH0vdjEuMC9hdXRoZW50aWNhdG9ycy8ke2F1dGhlbnRpY2F0b3JJZH1gO1xuICAgICAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICAgICAgICAgIHVybDogcGF0aCxcbiAgICAgICAgICAgIGRhdGE6IFt7XG4gICAgICAgICAgICAgICAgcGF0aDogJy9lbmFibGVkJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogZW5hYmxlZCxcbiAgICAgICAgICAgICAgICBvcDogJ3JlcGxhY2UnXG4gICAgICAgICAgICB9XSxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbi1wYXRjaCtqc29uJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVSZXNwb25zZShvcHRpb25zLCB0b2tlbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGZ1bmN0aW9uIGRlbGV0ZUF1dGhlbnRpY2F0b3IgZnVuY3Rpb24gdG8gZGVsZXRlIGEgc3BlY2lmaWMgYXV0aGVudGljYXRvciByZWdpc3RyYXRpb24gZm9yIElCTSBWZXJpZnkgaW5zdGFuY2VzIG9yXG4gICAgICogY3VzdG9tIG1vYmlsZSBhdXRoZW50aWNhdG9ycyB0aGF0IGFyZSBidWlsdCBmcm9tIHRoZSBJQk0gVmVyaWZ5IFNESy5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gYXV0aGVudGljYXRvcklkIElkIG9mIGF1dGhlbnRpY2F0ZWQgZGV2aWNlIHRvIGJlIGRlbGV0ZWQuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHRva2VuT2JqIGNvbnRhaW5pbmcgYWNjZXNzX3Rva2VuLCByZWZyZXNoX3Rva2VuIC4uLlxuICAgICAqL1xuICAgIGRlbGV0ZUF1dGhlbnRpY2F0b3IoYXV0aGVudGljYXRvcklkLCB0b2tlbk9iaikge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIgJiYgdGhpcy5jb25maWcuZmxvd1R5cGUgIT09IEZMT1dfVFlQRS5pbXBsaWNpdEZsb3cpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVmVyaWZ5RXJyb3IoQVVUSEVOVElDQVRPUl9DT05URVhUX0VSUk9SLCAnZGVsZXRlQXV0aGVudGljYXRvcihhdXRoZW50aWNhdG9ySWQsIHRva2VuKSwgMiBwYXJhbWV0ZXJzIGFyZSByZXF1aXJlZCAnICsgYXJndW1lbnRzLmxlbmd0aCArICcgd2VyZSBnaXZlbicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB0b2tlbiA9IHRva2VuT2JqIHx8IHRoaXMudG9rZW47XG4gICAgICAgIGxldCBwYXRoID0gYCR7dGhpcy5jb25maWcudGVuYW50VXJsfS92MS4wL2F1dGhlbnRpY2F0b3JzLyR7YXV0aGVudGljYXRvcklkfWA7XG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgICAgICAgIHVybDogcGF0aCxcbiAgICAgICAgICAgIGRhdGE6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVSZXNwb25zZShvcHRpb25zLCB0b2tlbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGZ1bmN0aW9uIG1ldGhvZEVuYWJsZWQgR2V0cyBvciBzZXRzIHRoZSBjdXJyZW50IHN0YXR1cyBvZiB0aGUgbWV0aG9kLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpZCBUaGUgc2lnbmF0dXJlIGVucm9sbG1lbnQgaWRlbnRpZmllclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gZW5hYmxlZCBFbmFibGUgLyBEaXNhYmxlIGVucm9sbGVkIHNpZ25hdHVyZSBtZXRob2QuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHRva2VuT2JqIGNvbnRhaW5pbmcgYWNjZXNzX3Rva2VuLCByZWZyZXNoX3Rva2VuIC4uLlxuICAgICAqL1xuICAgIG1ldGhvZEVuYWJsZWQoaWQsIGVuYWJsZWQsIHRva2VuT2JqKSB7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMyAmJiB0aGlzLmNvbmZpZy5mbG93VHlwZSAhPT0gRkxPV19UWVBFLmltcGxpY2l0Rmxvdykge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IsICdtZXRob2RFbmFibGVkKGlkLCBlbmFibGVkLCB0b2tlbiksIDMgcGFyYW1ldGVycyBhcmUgcmVxdWlyZWQgJyArIGFyZ3VtZW50cy5sZW5ndGggKyAnIHdlcmUgZ2l2ZW4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdG9rZW4gPSB0b2tlbk9iaiB8fCB0aGlzLnRva2VuO1xuICAgICAgICBsZXQgcGF0aCA9IGAke3RoaXMuY29uZmlnLnRlbmFudFVybH0vdjEuMC9hdXRobm1ldGhvZHMvc2lnbmF0dXJlcy8ke2lkfWA7XG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICAgICAgdXJsOiBwYXRoLFxuICAgICAgICAgICAgZGF0YTogW3tcbiAgICAgICAgICAgICAgICBwYXRoOiAnL2VuYWJsZWQnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBlbmFibGVkLFxuICAgICAgICAgICAgICAgIG9wOiAncmVwbGFjZSdcbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uLXBhdGNoK2pzb24nXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZVJlc3BvbnNlKG9wdGlvbnMsIHRva2VuKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZnVuY3Rpb24gbWV0aG9kcyBHZXRzIGFuIGFycmF5IG9mIG1ldGhvZCBvYmplY3RzIGNvbnRhaW5pbmcgYWxsIHRoZSBlbnJvbGxlZCBtZXRob2RzIGZvciBhIGdpdmVuIGF1dGhlbnRpY2F0b3IuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGF1dGhlbnRpY2F0b3JJZCB1bmlxdWUgSUQgb2YgcmVnaXN0ZXJlZCBhdXRoZW50aWNhdG9yXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHRva2VuT2JqIGNvbnRhaW5pbmcgYWNjZXNzX3Rva2VuLCByZWZyZXNoX3Rva2VuIC4uLlxuICAgICAqL1xuICAgIG1ldGhvZHMoYXV0aGVudGljYXRvcklkLCB0b2tlbk9iaikge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIgJiYgdGhpcy5jb25maWcuZmxvd1R5cGUgIT09IEZMT1dfVFlQRS5pbXBsaWNpdEZsb3cpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVmVyaWZ5RXJyb3IoQVVUSEVOVElDQVRPUl9DT05URVhUX0VSUk9SLCAnbWV0aG9kcyhhdXRoZW50aWNhdG9ySWQsIHRva2VuKSwgMiBwYXJhbWV0ZXJzIGFyZSByZXF1aXJlZCAnICsgYXJndW1lbnRzLmxlbmd0aCArICcgd2VyZSBnaXZlbicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB0b2tlbiA9IHRva2VuT2JqIHx8IHRoaXMudG9rZW47XG4gICAgICAgIGxldCBlbmNvZGVkVmFsdWUgPSBlbmNvZGVVUklDb21wb25lbnQoYGF0dHJpYnV0ZXMvYXV0aGVudGljYXRvcklkPVwiJHthdXRoZW50aWNhdG9ySWR9XCJgKTtcbiAgICAgICAgbGV0IHBhdGggPSBgJHt0aGlzLmNvbmZpZy50ZW5hbnRVcmx9L3YxLjAvYXV0aG5tZXRob2RzL3NpZ25hdHVyZXM/c2VhcmNoPSR7ZW5jb2RlZFZhbHVlfWA7XG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogcGF0aFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVSZXNwb25zZShvcHRpb25zLCB0b2tlbik7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEF1dGhlbnRpY2F0b3JDb250ZXh0O1xuIl19