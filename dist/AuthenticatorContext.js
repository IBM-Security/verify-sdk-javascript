"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _config=require("./config"),_VerifyError=_interopRequireDefault(require("./errors/VerifyError")),_utils=_interopRequireDefault(require("./helpers/utils"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}var AUTHENTICATOR_CONTEXT_ERROR=_config.AppConfig.AUTHENTICATOR_CONTEXT_ERROR,DEFAULT_POLLING_DELAY=_config.AppConfig.DEFAULT_POLLING_DELAY,DEFAULT_POLLING_ATTEMPTS=_config.AppConfig.DEFAULT_POLLING_ATTEMPTS;function AuthenticatorContext(a){if(!a)throw new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"Oauth parameter is required");this.oauth=a,this.config=this.oauth.getConfig(),"Implicit"===this.config.flowType&&(this.token=this._fetchToken())}AuthenticatorContext.prototype._fetchToken=function(){return this.oauth.fetchToken()},AuthenticatorContext.prototype._isAuthenticated=function(a){return this.oauth.isAuthenticated(a)},AuthenticatorContext.prototype._handleResponse=function(a,b){return this.oauth.handleResponse(a,b)},AuthenticatorContext.prototype.authenticators=function(a){var b=a||this.token;if(!b)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"token is a required parameter"));var c="".concat(this.config.tenantUrl,"/v1.0/authenticators");return this._handleResponse({method:"GET",url:c},b)},AuthenticatorContext.prototype.initiateAuthenticator=function(a,b){if(2>arguments.length&&"Implicit"!==this.config.flowType)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"initiateAuthenticator(dataObj, token), 2 parameters are required "+arguments.length+" were given"));if(!a)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"dataObj cannot be null"));var c={},d="?qrcodeInResponse=",e="".concat(this.config.tenantUrl,"/v1.0/authenticators/initiation");a.hasOwnProperty("qrcodeInResponse")&&!0===a.qrcodeInResponse&&(d="".concat(d,"true"),e="".concat(e).concat(d),c.accept="image/png");var f=b||this.token;return c={method:"POST",url:e,data:{owner:a.owner||null,clientId:this.config.registrationProfileId,accountName:a.accountName||"Default Account"}},this._handleResponse(c,f)},AuthenticatorContext.prototype.createVerification=function(a,b,c){if(3>arguments.length&&"Implicit"!==this.config.flowType)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"createVerification(authenticatorId, formData, token), 3 parameters are required "+arguments.length+" were given"));if(!b)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"formData is a required parameter"));var d=c||this.token,e="".concat(this.config.tenantUrl,"/v1.0/authenticators/").concat(a,"/verifications"),f={transactionData:{message:b.txMessage||" ",originIpAddress:b.originIpAddress||" ",originUserAgent:b.originUserAgent||" ",additionalData:b.txAdditionalData},pushNotification:{title:b.title||" ",send:b.send,message:b.pushMessage||" "},authenticationMethods:[{id:b.methodId,methodType:"signature"}],logic:"OR",expiresIn:b.expires||120};return this._handleResponse({method:"POST",url:e,data:f},d)},AuthenticatorContext.prototype.viewVerifications=function(a,b){if(2>arguments.length&&"Implicit"!==this.config.flowType)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"viewVerifications(authenticatorId, token), 2 parameters are required "+arguments.length+" were given"));var c=b||this.token,d="".concat(this.config.tenantUrl,"/v1.0/authenticators/").concat(a,"/verifications");return this._handleResponse({method:"GET",url:d},c)},AuthenticatorContext.prototype.viewVerification=function(a,b,c){if(3>arguments.length&&"Implicit"!==this.config.flowType)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"viewVerification(authenticatorId, transactionId, token), 3 parameters are required "+arguments.length+" were given"));var d=c||this.token,e="".concat(this.config.tenantUrl,"/v1.0/authenticators/").concat(a,"/verifications/").concat(b);return this._handleResponse({method:"GET",url:e},d)},AuthenticatorContext.prototype.pollVerification=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b,c,d,e,f){var g,h,i,j,k;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:g=d,h=f||DEFAULT_POLLING_ATTEMPTS,i=e||DEFAULT_POLLING_DELAY,j=!1;case 4:if(!(0<h)){a.next=22;break}return a.prev=5,a.next=8,this.viewVerification(b,c,d);case 8:if(k=a.sent,k.token&&(j=!0,g=k.token),"PENDING"===k.response.state&&"SENDING"===k.response.state){a.next=12;break}return a.abrupt("return",Promise.resolve({state:k.response.state,token:j?g:null}));case 12:return a.next=14,_utils.default.sleep(i);case 14:a.next=19;break;case 16:return a.prev=16,a.t0=a["catch"](5),a.abrupt("return",Promise.reject(a.t0));case 19:h--,a.next=4;break;case 22:return a.abrupt("return",Promise.reject(new _VerifyError.default("number of polling attempts exceeded")));case 23:case"end":return a.stop();}},a,this,[[5,16]])}));return function(){return a.apply(this,arguments)}}(),AuthenticatorContext.prototype.enabled=function(a,b,c){if(3>arguments.length&&"Implicit"!==this.config.flowType)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"enabled(authenticatorId, enabled, token), 3 parameters are required "+arguments.length+" were given"));var d=c||this.token,e="".concat(this.config.tenantUrl,"/v1.0/authenticators/").concat(a);return this._handleResponse({method:"PATCH",url:e,data:[{path:"/enabled",value:b,op:"replace"}],contentType:"application/json-patch+json"},d)},AuthenticatorContext.prototype.deleteAuthenticator=function(a,b){if(2>arguments.length&&"Implicit"!==this.config.flowType)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"deleteAuthenticator(authenticatorId, token), 2 parameters are required "+arguments.length+" were given"));var c=b||this.token,d="".concat(this.config.tenantUrl,"/v1.0/authenticators/").concat(a);return this._handleResponse({method:"DELETE",url:d,data:!1},c)},AuthenticatorContext.prototype.methodEnabled=function(a,b,c){if(3>arguments.length&&"Implicit"!==this.config.flowType)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"methodEnabled(id, enabled, token), 3 parameters are required "+arguments.length+" were given"));var d=c||this.token,e="".concat(this.config.tenantUrl,"/v1.0/authnmethods/signatures/").concat(a);return this._handleResponse({method:"PATCH",url:e,data:[{path:"/enabled",value:b,op:"replace"}],contentType:"application/json-patch+json"},d)},AuthenticatorContext.prototype.methods=function(a,b){if(2>arguments.length&&"Implicit"!==this.config.flowType)return Promise.reject(new _VerifyError.default(AUTHENTICATOR_CONTEXT_ERROR,"methods(authenticatorId, token), 2 parameters are required "+arguments.length+" were given"));var c=b||this.token,d=encodeURIComponent("attributes/authenticatorId=\"".concat(a,"\"")),e="".concat(this.config.tenantUrl,"/v1.0/authnmethods/signatures?search=").concat(d);return this._handleResponse({method:"GET",url:e},c)};var _default=AuthenticatorContext;exports.default=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9BdXRoZW50aWNhdG9yQ29udGV4dC5qcyJdLCJuYW1lcyI6WyJBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IiLCJBcHBDb25maWciLCJERUZBVUxUX1BPTExJTkdfREVMQVkiLCJERUZBVUxUX1BPTExJTkdfQVRURU1QVFMiLCJBdXRoZW50aWNhdG9yQ29udGV4dCIsIm9hdXRoIiwiVmVyaWZ5RXJyb3IiLCJjb25maWciLCJnZXRDb25maWciLCJmbG93VHlwZSIsInRva2VuIiwiX2ZldGNoVG9rZW4iLCJwcm90b3R5cGUiLCJmZXRjaFRva2VuIiwiX2lzQXV0aGVudGljYXRlZCIsImlzQXV0aGVudGljYXRlZCIsIl9oYW5kbGVSZXNwb25zZSIsIm9wdGlvbnMiLCJoYW5kbGVSZXNwb25zZSIsImF1dGhlbnRpY2F0b3JzIiwidG9rZW5PYmoiLCJQcm9taXNlIiwicmVqZWN0IiwicGF0aCIsInRlbmFudFVybCIsIm1ldGhvZCIsInVybCIsImluaXRpYXRlQXV0aGVudGljYXRvciIsImRhdGFPYmoiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJxcmNvZGVQYXJhbSIsImhhc093blByb3BlcnR5IiwicXJjb2RlSW5SZXNwb25zZSIsImFjY2VwdCIsImRhdGEiLCJvd25lciIsImNsaWVudElkIiwicmVnaXN0cmF0aW9uUHJvZmlsZUlkIiwiYWNjb3VudE5hbWUiLCJjcmVhdGVWZXJpZmljYXRpb24iLCJhdXRoZW50aWNhdG9ySWQiLCJmb3JtRGF0YSIsInRyYW5zYWN0aW9uRGF0YSIsIm1lc3NhZ2UiLCJ0eE1lc3NhZ2UiLCJvcmlnaW5JcEFkZHJlc3MiLCJvcmlnaW5Vc2VyQWdlbnQiLCJhZGRpdGlvbmFsRGF0YSIsInR4QWRkaXRpb25hbERhdGEiLCJwdXNoTm90aWZpY2F0aW9uIiwidGl0bGUiLCJzZW5kIiwicHVzaE1lc3NhZ2UiLCJhdXRoZW50aWNhdGlvbk1ldGhvZHMiLCJpZCIsIm1ldGhvZElkIiwibWV0aG9kVHlwZSIsImxvZ2ljIiwiZXhwaXJlc0luIiwiZXhwaXJlcyIsInZpZXdWZXJpZmljYXRpb25zIiwidmlld1ZlcmlmaWNhdGlvbiIsInRyYW5zYWN0aW9uSWQiLCJwb2xsVmVyaWZpY2F0aW9uIiwiZGVsYXkiLCJhdHRlbXB0cyIsIl90b2tlbk9iaiIsIl9hdHRlbXB0cyIsIl9kZWxheSIsInRva2VuUmVmcmVzaGVkIiwicGF5bG9hZCIsInJlc3BvbnNlIiwic3RhdGUiLCJyZXNvbHZlIiwidXRpbHMiLCJzbGVlcCIsImVuYWJsZWQiLCJ2YWx1ZSIsIm9wIiwiY29udGVudFR5cGUiLCJkZWxldGVBdXRoZW50aWNhdG9yIiwibWV0aG9kRW5hYmxlZCIsIm1ldGhvZHMiLCJlbmNvZGVkVmFsdWUiLCJlbmNvZGVVUklDb21wb25lbnQiXSwibWFwcGluZ3MiOiJrc0JBS0VBLENBQUFBLDJCLENBR0VDLGlCLENBSEZELDJCLENBQ0FFLHFCLENBRUVELGlCLENBRkZDLHFCLENBQ0FDLHdCLENBQ0VGLGlCLENBREZFLHdCLENBR0YsUUFBU0MsQ0FBQUEsb0JBQVQsQ0FBOEJDLENBQTlCLENBQXFDLENBQ25DLEdBQUksQ0FBQ0EsQ0FBTCxDQUNJLEtBQU0sSUFBSUMscUJBQUosQ0FBZ0JOLDJCQUFoQixDQUE2Qyw2QkFBN0MsQ0FBTixDQUVKLEtBQUtLLEtBQUwsQ0FBYUEsQ0FKc0IsQ0FLbkMsS0FBS0UsTUFBTCxDQUFjLEtBQUtGLEtBQUwsQ0FBV0csU0FBWCxFQUxxQixDQU1OLFVBQXpCLFFBQUtELE1BQUwsQ0FBWUUsUUFObUIsR0FPakMsS0FBS0MsS0FBTCxDQUFhLEtBQUtDLFdBQUwsRUFQb0IsQ0FTcEMsQ0FHRFAsb0JBQW9CLENBQUNRLFNBQXJCLENBQStCRCxXQUEvQixDQUE2QyxVQUFVLENBQ3JELE1BQU8sTUFBS04sS0FBTCxDQUFXUSxVQUFYLEVBQ1IsQyxDQUNEVCxvQkFBb0IsQ0FBQ1EsU0FBckIsQ0FBK0JFLGdCQUEvQixDQUFrRCxTQUFTSixDQUFULENBQWUsQ0FDL0QsTUFBTyxNQUFLTCxLQUFMLENBQVdVLGVBQVgsQ0FB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VCxDQUEwQnJCLENBQTFCLENBQW9DLENBQzNFLEdBQXVCLENBQW5CLENBQUFTLFNBQVMsQ0FBQ0MsTUFBVixFQUFrRCxVQUF6QixRQUFLdkIsTUFBTCxDQUFZRSxRQUF6QyxDQUNFLE1BQU9ZLENBQUFBLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLEdBQUloQixxQkFBSixDQUFnQk4sMkJBQWhCLENBQTZDLDhEQUFnRTZCLFNBQVMsQ0FBQ0MsTUFBMUUsQ0FBbUYsYUFBaEksQ0FBZixDQUFQLENBRnlFLEdBS3ZFcEIsQ0FBQUEsQ0FBSyxDQUFHVSxDQUFRLEVBQUksS0FBS1YsS0FMOEMsQ0FNdkUwRSxDQUFZLENBQUdDLGtCQUFrQix3Q0FBZ0M1QyxDQUFoQyxPQU5zQyxDQU92RWxCLENBQUksV0FBTSxLQUFLaEIsTUFBTCxDQUFZaUIsU0FBbEIsaURBQW1FNEQsQ0FBbkUsQ0FQbUUsQ0FhM0UsTUFBTyxNQUFLcEUsZUFBTCxDQUxPLENBQ1pTLE1BQU0sQ0FBRSxLQURJLENBRVpDLEdBQUcsQ0FBRUgsQ0FGTyxDQUtQLENBQThCYixDQUE5QixDQUNSLEMsY0FFY04sb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0FwcENvbmZpZ30gZnJvbSAnLi9jb25maWcnO1xuaW1wb3J0IFZlcmlmeUVycm9yIGZyb20gJy4vZXJyb3JzL1ZlcmlmeUVycm9yJztcbmltcG9ydCB1dGlscyBmcm9tICcuL2hlbHBlcnMvdXRpbHMnO1xuXG5jb25zdCB7XG4gIEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUixcbiAgREVGQVVMVF9QT0xMSU5HX0RFTEFZLFxuICBERUZBVUxUX1BPTExJTkdfQVRURU1QVFNcbn0gPSBBcHBDb25maWc7XG5cbmZ1bmN0aW9uIEF1dGhlbnRpY2F0b3JDb250ZXh0KG9hdXRoKSB7XG4gIGlmICghb2F1dGgpIHtcbiAgICAgIHRocm93IG5ldyBWZXJpZnlFcnJvcihBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IsICdPYXV0aCBwYXJhbWV0ZXIgaXMgcmVxdWlyZWQnKTtcbiAgfVxuICB0aGlzLm9hdXRoID0gb2F1dGg7XG4gIHRoaXMuY29uZmlnID0gdGhpcy5vYXV0aC5nZXRDb25maWcoKTtcbiAgaWYgKHRoaXMuY29uZmlnLmZsb3dUeXBlID09PSAnSW1wbGljaXQnKXtcbiAgICB0aGlzLnRva2VuID0gdGhpcy5fZmV0Y2hUb2tlbigpO1xuICB9XG59XG5cblxuQXV0aGVudGljYXRvckNvbnRleHQucHJvdG90eXBlLl9mZXRjaFRva2VuID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMub2F1dGguZmV0Y2hUb2tlbigpO1xufTtcbkF1dGhlbnRpY2F0b3JDb250ZXh0LnByb3RvdHlwZS5faXNBdXRoZW50aWNhdGVkID0gZnVuY3Rpb24odG9rZW4pe1xuICByZXR1cm4gdGhpcy5vYXV0aC5pc0F1dGhlbnRpY2F0ZWQodG9rZW4pO1xufTtcbkF1dGhlbnRpY2F0b3JDb250ZXh0LnByb3RvdHlwZS5faGFuZGxlUmVzcG9uc2UgPSBmdW5jdGlvbihvcHRpb25zLCB0b2tlbil7XG4gIHJldHVybiB0aGlzLm9hdXRoLmhhbmRsZVJlc3BvbnNlKG9wdGlvbnMsIHRva2VuKTtcbn07XG5cbi8qKlxuICogVGhlIEF1dGhlbnRpY2F0b3Igb2JqZWN0IHByb3ZpZGVzIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMgdG8gdmlld1xuICogZGV2aWNlIGluZm9ybWF0aW9uIGFuZCByZW1vdmUgbWV0aG9kc1xuICogQHBhcmFtIHtvYmplY3R9IHRva2VuT2JqIGNvbnRhaW5pbmcgYWNjZXNzX3Rva2VuLCByZWZyZXNoX3Rva2VuIC4uLlxuICovXG5BdXRoZW50aWNhdG9yQ29udGV4dC5wcm90b3R5cGUuYXV0aGVudGljYXRvcnMgPSBmdW5jdGlvbih0b2tlbk9iaikge1xuICBsZXQgdG9rZW4gPSB0b2tlbk9iaiB8fCB0aGlzLnRva2VuO1xuICBpZiAoIXRva2VuKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUiwgJ3Rva2VuIGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyJykpO1xuICB9XG4gIGxldCBwYXRoID0gYCR7dGhpcy5jb25maWcudGVuYW50VXJsfS92MS4wL2F1dGhlbnRpY2F0b3JzYDtcbiAgbGV0IG9wdGlvbnMgPSB7XG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICB1cmw6IHBhdGhcbiAgfTtcblxuICByZXR1cm4gdGhpcy5faGFuZGxlUmVzcG9uc2Uob3B0aW9ucywgdG9rZW4pO1xufTtcblxuLyoqXG4gKiBAZnVuY3Rpb24gaW5pdGlhdGVBdXRoZW50aWNhdG9yXG4gKiBJbml0aWF0ZXMgYSBuZXcgYXV0aGVudGljYXRvciB0aGF0IHRoZSBjbGllbnQgY2FuIG9yIGVudGVyIG1hbnVhbGx5IHVzaW5nIGEgbW9iaWxlIGRldmljZS5cbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgYmFzZTY0IGVuY29kZWQgZGF0YSByZXByZXNlbnRpbmcgYSBRUiBjb2RlLlxuICogQHBhcmFtIHtvYmplY3R9IGRhdGFPYmogY29udGFpbmluZyBhIHVzZXIgZnJpZW5kbHkgbmFtZSBmb3IgdGhlIHJlZ2lzdHJhdGlvbi5cbiAqIEBwYXJhbSB7b2JqZWN0fSB0b2tlbk9iaiBjb250YWluaW5nIGFjY2Vzc190b2tlbiwgcmVmcmVzaF90b2tlbiAuLi5cbiAqL1xuQXV0aGVudGljYXRvckNvbnRleHQucHJvdG90eXBlLmluaXRpYXRlQXV0aGVudGljYXRvciA9IGZ1bmN0aW9uKGRhdGFPYmosIHRva2VuT2JqKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMiAmJiB0aGlzLmNvbmZpZy5mbG93VHlwZSAhPT0gJ0ltcGxpY2l0JyApIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVmVyaWZ5RXJyb3IoQVVUSEVOVElDQVRPUl9DT05URVhUX0VSUk9SLCAnaW5pdGlhdGVBdXRoZW50aWNhdG9yKGRhdGFPYmosIHRva2VuKSwgMiBwYXJhbWV0ZXJzIGFyZSByZXF1aXJlZCAnICsgYXJndW1lbnRzLmxlbmd0aCArICcgd2VyZSBnaXZlbicpKTtcbiAgfVxuXG4gIGlmICghZGF0YU9iaikge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IsICdkYXRhT2JqIGNhbm5vdCBiZSBudWxsJykpO1xuICB9XG5cbiAgbGV0IG9wdGlvbnMgPSB7fTtcbiAgbGV0IHFyY29kZVBhcmFtID0gJz9xcmNvZGVJblJlc3BvbnNlPSc7XG4gIGxldCBwYXRoID0gYCR7dGhpcy5jb25maWcudGVuYW50VXJsfS92MS4wL2F1dGhlbnRpY2F0b3JzL2luaXRpYXRpb25gO1xuXG4gIGlmIChkYXRhT2JqLmhhc093blByb3BlcnR5KCdxcmNvZGVJblJlc3BvbnNlJykgJiYgZGF0YU9iai5xcmNvZGVJblJlc3BvbnNlID09PSB0cnVlKXtcbiAgICAgIHFyY29kZVBhcmFtID0gYCR7cXJjb2RlUGFyYW19dHJ1ZWA7XG4gICAgICBwYXRoID0gYCR7cGF0aH0ke3FyY29kZVBhcmFtfWA7XG4gICAgICBvcHRpb25zLmFjY2VwdCA9ICdpbWFnZS9wbmcnO1xuICB9XG5cbiAgbGV0IHRva2VuID0gdG9rZW5PYmogfHwgdGhpcy50b2tlbjtcbiAgb3B0aW9ucyA9IHtcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICB1cmw6IHBhdGgsXG4gICAgZGF0YToge1xuICAgICAgICBvd25lcjogZGF0YU9iai5vd25lciB8fCBudWxsLFxuICAgICAgICBjbGllbnRJZDogdGhpcy5jb25maWcucmVnaXN0cmF0aW9uUHJvZmlsZUlkLFxuICAgICAgICBhY2NvdW50TmFtZTogZGF0YU9iai5hY2NvdW50TmFtZSB8fCAnRGVmYXVsdCBBY2NvdW50J1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIHRoaXMuX2hhbmRsZVJlc3BvbnNlKG9wdGlvbnMsIHRva2VuKTtcbn07XG5cblxuLyoqXG4gKiBAZnVuY3Rpb24gY3JlYXRlVmVyaWZpY2F0aW9uIGZ1bmN0aW9uIGNyZWF0ZXMgYSB0cmFuc2FjdGlvbiBhbmQgc2VuZHMgYSBwdXNoIG5vdGlmaWNhdGlvbiB0byB0aGUgYXNzb2NpYXRlZCBhdXRoZW50aWNhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGF1dGhlbnRpY2F0b3JJZCBDcmVhdGVzIGEgbmV3IHZlcmlmaWNhdGlvbiBmb3IgdGhlIHJlZ2lzdGVyZWQgYXV0aGVudGljYXRvci5cbiAqIEBwYXJhbSB7b2JqZWN0fSBmb3JtRGF0YSAgYSBKU09OIHBheWxvYWQgdGhhdCBzcGVjaWZpZXMgdGhlIHZlcmlmaWNhdGlvbiB0cmFuc2FjdGlvbiBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gdG9rZW5PYmogY29udGFpbmluZyBhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW4gLi4uXG4gKi9cbkF1dGhlbnRpY2F0b3JDb250ZXh0LnByb3RvdHlwZS5jcmVhdGVWZXJpZmljYXRpb24gPSBmdW5jdGlvbihhdXRoZW50aWNhdG9ySWQsIGZvcm1EYXRhLCB0b2tlbk9iaikge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMgJiYgdGhpcy5jb25maWcuZmxvd1R5cGUgIT09ICdJbXBsaWNpdCcpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUiwgJ2NyZWF0ZVZlcmlmaWNhdGlvbihhdXRoZW50aWNhdG9ySWQsIGZvcm1EYXRhLCB0b2tlbiksIDMgcGFyYW1ldGVycyBhcmUgcmVxdWlyZWQgJyArIGFyZ3VtZW50cy5sZW5ndGggKyAnIHdlcmUgZ2l2ZW4nKSk7XG4gIH1cbiAgXG4gIGlmICghZm9ybURhdGEpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUiwgJ2Zvcm1EYXRhIGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyJykpO1xuICB9XG4gIFxuICBsZXQgdG9rZW4gPSB0b2tlbk9iaiB8fCB0aGlzLnRva2VuO1xuICBsZXQgcGF0aCA9IGAke3RoaXMuY29uZmlnLnRlbmFudFVybH0vdjEuMC9hdXRoZW50aWNhdG9ycy8ke2F1dGhlbnRpY2F0b3JJZH0vdmVyaWZpY2F0aW9uc2A7XG5cbiAgbGV0IGRhdGEgPSB7XG4gICAgdHJhbnNhY3Rpb25EYXRhOiB7XG4gICAgICBtZXNzYWdlOiBmb3JtRGF0YS50eE1lc3NhZ2UgfHwgJyAnLFxuICAgICAgb3JpZ2luSXBBZGRyZXNzOiBmb3JtRGF0YS5vcmlnaW5JcEFkZHJlc3MgfHwgJyAnLFxuICAgICAgb3JpZ2luVXNlckFnZW50OiBmb3JtRGF0YS5vcmlnaW5Vc2VyQWdlbnQgfHwgJyAnLFxuICAgICAgYWRkaXRpb25hbERhdGE6IGZvcm1EYXRhLnR4QWRkaXRpb25hbERhdGFcbiAgICB9LFxuICAgIHB1c2hOb3RpZmljYXRpb246IHtcbiAgICAgIHRpdGxlOiBmb3JtRGF0YS50aXRsZSB8fCAnICcsXG4gICAgICBzZW5kOiBmb3JtRGF0YS5zZW5kLFxuICAgICAgbWVzc2FnZTogZm9ybURhdGEucHVzaE1lc3NhZ2UgfHwgJyAnXG4gICAgfSxcbiAgICBhdXRoZW50aWNhdGlvbk1ldGhvZHM6IFt7XG4gICAgICBpZDogZm9ybURhdGEubWV0aG9kSWQsXG4gICAgICBtZXRob2RUeXBlOiAnc2lnbmF0dXJlJ1xuICAgIH1dLFxuICAgIGxvZ2ljOiAnT1InLFxuICAgIGV4cGlyZXNJbjogZm9ybURhdGEuZXhwaXJlcyB8fCAxMjBcbiAgfTtcblxuICBsZXQgb3B0aW9ucyA9IHtcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICB1cmw6IHBhdGgsXG4gICAgZGF0YTogZGF0YVxuICB9O1xuXG4gIHJldHVybiB0aGlzLl9oYW5kbGVSZXNwb25zZShvcHRpb25zLCB0b2tlbik7XG59O1xuXG5cbi8qKlxuICogQGZ1bmN0aW9uIHZpZXdWZXJpZmljYXRpb25zIFJldHJpZXZlIHRoZSBsaXN0IG9mIHZlcmlmaWNhdGlvbiB0cmFuc2FjdGlvbnMuXG4gKiBAcGFyYW0ge3N0cmluZ30gYXV0aGVudGljYXRvcklkIFRoZSBhdXRoZW50aWNhdG9yIHJlZ2lzdHJhdGlvbiBpZGVudGlmaWVyLlxuICogQHBhcmFtIHtvYmplY3R9IHRva2VuT2JqIGNvbnRhaW5pbmcgYWNjZXNzX3Rva2VuLCByZWZyZXNoX3Rva2VuIC4uLlxuICovXG5BdXRoZW50aWNhdG9yQ29udGV4dC5wcm90b3R5cGUudmlld1ZlcmlmaWNhdGlvbnMgPSBmdW5jdGlvbihhdXRoZW50aWNhdG9ySWQsIHRva2VuT2JqKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMiAmJiB0aGlzLmNvbmZpZy5mbG93VHlwZSAhPT0gJ0ltcGxpY2l0JyApIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUiwgJ3ZpZXdWZXJpZmljYXRpb25zKGF1dGhlbnRpY2F0b3JJZCwgdG9rZW4pLCAyIHBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyB3ZXJlIGdpdmVuJykpO1xuICB9XG4gIFxuICBsZXQgdG9rZW4gPSB0b2tlbk9iaiB8fCB0aGlzLnRva2VuO1xuICBsZXQgcGF0aCA9IGAke3RoaXMuY29uZmlnLnRlbmFudFVybH0vdjEuMC9hdXRoZW50aWNhdG9ycy8ke2F1dGhlbnRpY2F0b3JJZH0vdmVyaWZpY2F0aW9uc2A7XG4gIGxldCBvcHRpb25zID0ge1xuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgdXJsOiBwYXRoXG4gIH07XG4gIHJldHVybiB0aGlzLl9oYW5kbGVSZXNwb25zZShvcHRpb25zLCB0b2tlbik7XG59O1xuXG4vKipcbiAqIEBmdW5jdGlvbiB2aWV3VmVyaWZpY2F0aW9uIFJldHJpZXZlIGEgc3BlY2lmaWMgdmVyaWZpY2F0aW9uIHRyYW5zYWN0aW9uIHRoYXQgaXMgYXNzb2NpYXRlZCB3aXRoIGFuIGF1dGhlbnRpY2F0b3IgcmVnaXN0cmF0aW9uLlxuICogQHBhcmFtIHtzdHJpbmd9IGF1dGhlbnRpY2F0b3JJZCBUaGUgYXV0aGVudGljYXRvciByZWdpc3RyYXRpb24gaWRlbnRpZmllci5cbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2FjdGlvbklkIFRoZSB2ZXJpZmljYXRpb24gdHJhbnNhY3Rpb24gaWRlbnRpZmllci5cbiAqIEBwYXJhbSB7b2JqZWN0fSB0b2tlbk9iaiBjb250YWluaW5nIGFjY2Vzc190b2tlbiwgcmVmcmVzaF90b2tlbiAuLi5cbiAqL1xuQXV0aGVudGljYXRvckNvbnRleHQucHJvdG90eXBlLnZpZXdWZXJpZmljYXRpb24gPSBmdW5jdGlvbihhdXRoZW50aWNhdG9ySWQsIHRyYW5zYWN0aW9uSWQsIHRva2VuT2JqKXtcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMyAmJiB0aGlzLmNvbmZpZy5mbG93VHlwZSAhPT0gJ0ltcGxpY2l0JyApIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IsICd2aWV3VmVyaWZpY2F0aW9uKGF1dGhlbnRpY2F0b3JJZCwgdHJhbnNhY3Rpb25JZCwgdG9rZW4pLCAzIHBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyB3ZXJlIGdpdmVuJykpO1xuICAgICAgfVxuICAgICAgXG4gIGxldCB0b2tlbiA9IHRva2VuT2JqIHx8IHRoaXMudG9rZW47XG4gIGxldCBwYXRoID0gYCR7dGhpcy5jb25maWcudGVuYW50VXJsfS92MS4wL2F1dGhlbnRpY2F0b3JzLyR7YXV0aGVudGljYXRvcklkfS92ZXJpZmljYXRpb25zLyR7dHJhbnNhY3Rpb25JZH1gO1xuICBsZXQgb3B0aW9ucyA9IHtcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIHVybDogcGF0aFxuICB9O1xuICByZXR1cm4gdGhpcy5faGFuZGxlUmVzcG9uc2Uob3B0aW9ucywgdG9rZW4pO1xufTtcblxuLyoqXG4gKiBAZnVuY3Rpb24gcG9sbFZlcmlmaWNhdGlvbiByZWN1cnNpdmUgZnVuY3Rpb24gdGhhdCBwb2xscyBhIGdpdmVuIHRyYW5zYWN0aW9uIGlkIGZvciBhIHN0YXRlIGNoYW5nZVxuICogQHBhcmFtIHtzdHJpbmd9IGF1dGhlbnRpY2F0b3JJZCBhdXRoZW50aWNhdG9yIGlkXG4gKiBAcGFyYW0ge29iamVjdH0gdHJhbnNhY3Rpb25JZCB0cmFuc2FjdGlvbiBpZFxuICogQHBhcmFtIHtvYmplY3R9IHRva2VuT2JqIGNvbnRhaW5pbmcgYWNjZXNzX3Rva2VuLCByZWZyZXNoX3Rva2VuIC4uLlxuICogQHBhcmFtIHtvYmplY3R9IGRlbGF5IGRlbGF5IGJldHdlZW4gcG9sbHNcbiAqIEBwYXJhbSB7b2JqZWN0fSBhdHRlbXB0cyBob3cgbWFueSB0aW1lcyB0byBwb2xsXG4gKi9cbkF1dGhlbnRpY2F0b3JDb250ZXh0LnByb3RvdHlwZS5wb2xsVmVyaWZpY2F0aW9uID0gIGFzeW5jIGZ1bmN0aW9uKGF1dGhlbnRpY2F0b3JJZCwgdHJhbnNhY3Rpb25JZCwgdG9rZW5PYmosIGRlbGF5LCBhdHRlbXB0cykge1xuICBsZXQgX3Rva2VuT2JqID0gdG9rZW5PYmo7XG4gIGxldCBfYXR0ZW1wdHMgPSBhdHRlbXB0cyB8fCBERUZBVUxUX1BPTExJTkdfQVRURU1QVFM7XG4gIGxldCBfZGVsYXkgPSBkZWxheSB8fCBERUZBVUxUX1BPTExJTkdfREVMQVk7XG5cbiAgbGV0IHRva2VuUmVmcmVzaGVkID0gZmFsc2U7XG5cbiAgd2hpbGUgKF9hdHRlbXB0cyA+IDApe1xuICAgIHRyeSB7XG4gICAgICBsZXQgcGF5bG9hZCA9IGF3YWl0IHRoaXMudmlld1ZlcmlmaWNhdGlvbihhdXRoZW50aWNhdG9ySWQsIHRyYW5zYWN0aW9uSWQsIHRva2VuT2JqKTtcblxuICAgICAgLy8gdG9rZW4gd2FzIHJlZnJlc2hlZFxuICAgICAgaWYgKHBheWxvYWQudG9rZW4pIHtcbiAgICAgICAgdG9rZW5SZWZyZXNoZWQgPSB0cnVlO1xuICAgICAgICBfdG9rZW5PYmogPSBwYXlsb2FkLnRva2VuO1xuICAgICAgfVxuXG4gICAgICAvLyAnUEVORElORycgaXMgZGVmYXVsdCB2YWx1ZVxuICAgICAgaWYgKHBheWxvYWQucmVzcG9uc2Uuc3RhdGUgIT09ICdQRU5ESU5HJyB8fCBwYXlsb2FkLnJlc3BvbnNlLnN0YXRlICE9PSAnU0VORElORycpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7c3RhdGU6IHBheWxvYWQucmVzcG9uc2Uuc3RhdGUsIHRva2VuOiB0b2tlblJlZnJlc2hlZCA/IF90b2tlbk9iaiA6IG51bGx9KTtcbiAgICAgIH1cblxuICAgICAgYXdhaXQgdXRpbHMuc2xlZXAoX2RlbGF5KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICB9XG5cbiAgICAgIF9hdHRlbXB0cyAtLTtcbiAgICB9XG5cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKCdudW1iZXIgb2YgcG9sbGluZyBhdHRlbXB0cyBleGNlZWRlZCcpKTtcbn07XG5cbi8qKlxuICogQGZ1bmN0aW9uIGVuYWJsZWQgZnVuY3Rpb24gdG8gdXBkYXRlIGF0dHJpYnV0ZXMgb2YgYSBzcGVjaWZpYyBhdXRoZW50aWNhdG9yIHJlZ2lzdHJhdGlvbiBmb3JcbiAqIElCTSBWZXJpZnkgaW5zdGFuY2VzIG9yIGN1c3RvbSBtb2JpbGUgYXV0aGVudGljYXRvcnMgdGhhdCBhcmUgYnVpbHQgZnJvbSB0aGUgSUJNIFZlcmlmeSBTREsuXG4gKiBAcGFyYW0ge3N0cmluZ30gYXV0aGVudGljYXRvcklkIElkIG9mIGF1dGhlbnRpY2F0ZWQgZGV2aWNlXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGVuYWJsZWQgYm9vbGVhbiB0byBlbmFibGUvZGlzYWJsZSBlbnJvbGxlZCBtZXRob2RcbiAqIEBwYXJhbSB7b2JqZWN0fSB0b2tlbk9iaiBjb250YWluaW5nIGFjY2Vzc190b2tlbiwgcmVmcmVzaF90b2tlbiAuLi5cbiAqL1xuQXV0aGVudGljYXRvckNvbnRleHQucHJvdG90eXBlLmVuYWJsZWQgPSBmdW5jdGlvbihhdXRoZW50aWNhdG9ySWQsIGVuYWJsZWQsIHRva2VuT2JqKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMyAgJiYgdGhpcy5jb25maWcuZmxvd1R5cGUgIT09ICdJbXBsaWNpdCcpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUiwgJ2VuYWJsZWQoYXV0aGVudGljYXRvcklkLCBlbmFibGVkLCB0b2tlbiksIDMgcGFyYW1ldGVycyBhcmUgcmVxdWlyZWQgJyArIGFyZ3VtZW50cy5sZW5ndGggKyAnIHdlcmUgZ2l2ZW4nKSk7XG4gIH1cbiAgXG4gIGxldCB0b2tlbiA9IHRva2VuT2JqIHx8IHRoaXMudG9rZW47XG4gIGxldCBwYXRoID0gYCR7dGhpcy5jb25maWcudGVuYW50VXJsfS92MS4wL2F1dGhlbnRpY2F0b3JzLyR7YXV0aGVudGljYXRvcklkfWA7XG4gIGxldCBvcHRpb25zID0ge1xuICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICB1cmw6IHBhdGgsXG4gICAgZGF0YTogW3tcbiAgICAgIHBhdGg6ICcvZW5hYmxlZCcsXG4gICAgICB2YWx1ZTogZW5hYmxlZCxcbiAgICAgIG9wOiAncmVwbGFjZSdcbiAgICB9XSxcbiAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24tcGF0Y2granNvbidcbiAgfTtcblxuICByZXR1cm4gdGhpcy5faGFuZGxlUmVzcG9uc2Uob3B0aW9ucywgdG9rZW4pO1xufTtcblxuLyoqXG4gKiBAZnVuY3Rpb24gZGVsZXRlQXV0aGVudGljYXRvciBmdW5jdGlvbiB0byBkZWxldGUgYSBzcGVjaWZpYyBhdXRoZW50aWNhdG9yIHJlZ2lzdHJhdGlvbiBmb3IgSUJNIFZlcmlmeSBpbnN0YW5jZXMgb3JcbiAqIGN1c3RvbSBtb2JpbGUgYXV0aGVudGljYXRvcnMgdGhhdCBhcmUgYnVpbHQgZnJvbSB0aGUgSUJNIFZlcmlmeSBTREsuXG4gKiBAcGFyYW0ge3N0cmluZ30gYXV0aGVudGljYXRvcklkIElkIG9mIGF1dGhlbnRpY2F0ZWQgZGV2aWNlIHRvIGJlIGRlbGV0ZWQuXG4gKiBAcGFyYW0ge29iamVjdH0gdG9rZW5PYmogY29udGFpbmluZyBhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW4gLi4uXG4gKi9cbkF1dGhlbnRpY2F0b3JDb250ZXh0LnByb3RvdHlwZS5kZWxldGVBdXRoZW50aWNhdG9yID0gZnVuY3Rpb24oYXV0aGVudGljYXRvcklkLCB0b2tlbk9iaikge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIgICYmIHRoaXMuY29uZmlnLmZsb3dUeXBlICE9PSAnSW1wbGljaXQnKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IsICdkZWxldGVBdXRoZW50aWNhdG9yKGF1dGhlbnRpY2F0b3JJZCwgdG9rZW4pLCAyIHBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyB3ZXJlIGdpdmVuJykpO1xuICB9XG4gIFxuICBsZXQgdG9rZW4gPSB0b2tlbk9iaiB8fCB0aGlzLnRva2VuO1xuICBsZXQgcGF0aCA9IGAke3RoaXMuY29uZmlnLnRlbmFudFVybH0vdjEuMC9hdXRoZW50aWNhdG9ycy8ke2F1dGhlbnRpY2F0b3JJZH1gO1xuICBsZXQgb3B0aW9ucyA9IHtcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIHVybDogcGF0aCxcbiAgICBkYXRhOiBmYWxzZVxuICB9O1xuICByZXR1cm4gdGhpcy5faGFuZGxlUmVzcG9uc2Uob3B0aW9ucywgdG9rZW4pO1xufTtcblxuLyoqXG4gKiBAZnVuY3Rpb24gbWV0aG9kRW5hYmxlZCBHZXRzIG9yIHNldHMgdGhlIGN1cnJlbnQgc3RhdHVzIG9mIHRoZSBtZXRob2QuXG4gKiBAcGFyYW0ge3N0cmluZ30gaWQgVGhlIHNpZ25hdHVyZSBlbnJvbGxtZW50IGlkZW50aWZpZXJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZW5hYmxlZCBFbmFibGUgLyBEaXNhYmxlIGVucm9sbGVkIHNpZ25hdHVyZSBtZXRob2QuXG4gKiBAcGFyYW0ge29iamVjdH0gdG9rZW5PYmogY29udGFpbmluZyBhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW4gLi4uXG4gKi9cbkF1dGhlbnRpY2F0b3JDb250ZXh0LnByb3RvdHlwZS5tZXRob2RFbmFibGVkID0gZnVuY3Rpb24oaWQsIGVuYWJsZWQsIHRva2VuT2JqKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMyAgJiYgdGhpcy5jb25maWcuZmxvd1R5cGUgIT09ICdJbXBsaWNpdCcpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFZlcmlmeUVycm9yKEFVVEhFTlRJQ0FUT1JfQ09OVEVYVF9FUlJPUiwgJ21ldGhvZEVuYWJsZWQoaWQsIGVuYWJsZWQsIHRva2VuKSwgMyBwYXJhbWV0ZXJzIGFyZSByZXF1aXJlZCAnICsgYXJndW1lbnRzLmxlbmd0aCArICcgd2VyZSBnaXZlbicpKTtcbiAgfVxuICBcbiAgbGV0IHRva2VuID0gdG9rZW5PYmogfHwgdGhpcy50b2tlbjtcbiAgbGV0IHBhdGggPSBgJHt0aGlzLmNvbmZpZy50ZW5hbnRVcmx9L3YxLjAvYXV0aG5tZXRob2RzL3NpZ25hdHVyZXMvJHtpZH1gO1xuICBsZXQgb3B0aW9ucyA9IHtcbiAgICBtZXRob2Q6ICdQQVRDSCcsXG4gICAgdXJsOiBwYXRoLFxuICAgIGRhdGE6IFt7XG4gICAgICBwYXRoOiAnL2VuYWJsZWQnLFxuICAgICAgdmFsdWU6IGVuYWJsZWQsXG4gICAgICBvcDogJ3JlcGxhY2UnXG4gICAgfV0sXG4gICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uLXBhdGNoK2pzb24nXG4gIH07XG5cbiAgcmV0dXJuIHRoaXMuX2hhbmRsZVJlc3BvbnNlKG9wdGlvbnMsIHRva2VuKTtcbn07XG5cbi8qKlxuICogQGZ1bmN0aW9uIG1ldGhvZHMgR2V0cyBhbiBhcnJheSBvZiBtZXRob2Qgb2JqZWN0cyBjb250YWluaW5nIGFsbCB0aGUgZW5yb2xsZWQgbWV0aG9kcyBmb3IgYSBnaXZlbiBhdXRoZW50aWNhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGF1dGhlbnRpY2F0b3JJZCB1bmlxdWUgSUQgb2YgcmVnaXN0ZXJlZCBhdXRoZW50aWNhdG9yXG4gKiBAcGFyYW0ge29iamVjdH0gdG9rZW5PYmogY29udGFpbmluZyBhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW4gLi4uXG4gKi9cbkF1dGhlbnRpY2F0b3JDb250ZXh0LnByb3RvdHlwZS5tZXRob2RzID0gZnVuY3Rpb24oYXV0aGVudGljYXRvcklkLCB0b2tlbk9iaikge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIgICYmIHRoaXMuY29uZmlnLmZsb3dUeXBlICE9PSAnSW1wbGljaXQnKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBWZXJpZnlFcnJvcihBVVRIRU5USUNBVE9SX0NPTlRFWFRfRVJST1IsICdtZXRob2RzKGF1dGhlbnRpY2F0b3JJZCwgdG9rZW4pLCAyIHBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyB3ZXJlIGdpdmVuJykpO1xuICB9XG4gIFxuICBsZXQgdG9rZW4gPSB0b2tlbk9iaiB8fCB0aGlzLnRva2VuO1xuICBsZXQgZW5jb2RlZFZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KGBhdHRyaWJ1dGVzL2F1dGhlbnRpY2F0b3JJZD1cIiR7YXV0aGVudGljYXRvcklkfVwiYCk7XG4gIGxldCBwYXRoID0gYCR7dGhpcy5jb25maWcudGVuYW50VXJsfS92MS4wL2F1dGhubWV0aG9kcy9zaWduYXR1cmVzP3NlYXJjaD0ke2VuY29kZWRWYWx1ZX1gO1xuICBsZXQgb3B0aW9ucyA9IHtcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIHVybDogcGF0aFxuICB9O1xuXG4gIHJldHVybiB0aGlzLl9oYW5kbGVSZXNwb25zZShvcHRpb25zLCB0b2tlbik7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBBdXRoZW50aWNhdG9yQ29udGV4dDtcbiJdfQ==